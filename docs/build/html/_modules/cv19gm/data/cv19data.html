<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cv19gm.data.cv19data &mdash; cv19gm 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> cv19gm
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">cv19gm</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">cv19gm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">cv19gm.data.cv19data</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cv19gm.data.cv19data</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pandas.core.base</span> <span class="kn">import</span> <span class="n">DataError</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests.auth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span> 

<span class="c1"># cv19gm libraries </span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1">#from pathlib import Path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">cv19gm.utils.cv19timeutils</span> <span class="kn">import</span> <span class="n">timeJStoPy</span> 

<span class="sd">&quot;&quot;&quot;   </span>
<span class="sd">   Import and analyse data </span>


<span class="sd">    To Do:</span>
<span class="sd">        * Save data to file </span>
<span class="sd">        * Load data from file</span>
<span class="sd">        * Creación de df de información (self.info) sobre los datos (self.data)</span>
<span class="sd">        * Estandarizar nombres de variables de hospitalización</span>
<span class="sd">        * Expandir creación de dataframe a todas las funciones de importación</span>
<span class="sd">        * Función que devuelva serie de tiempo sin nulls. Puede ser necesario para funciones de análisis de datos</span>
<span class="sd">        * Manually add data ()</span>

<span class="sd">    self.resume:</span>
<span class="sd">        country,state,county,healthservice, population, initdate, update_date, dataindex</span>
<span class="sd">    self.datainfo:</span>
<span class="sd">        endpoint,initdate,enddate,update_date,sim_var, complete name, additional info.</span>


<span class="sd">    #CUT Regiones:</span>
<span class="sd">    </span>
<span class="sd">    Names = [&#39;Arica y Parinacota&#39;,&#39;Tarapacá&#39;,&#39;Antofagasta&#39;,&#39;Atacama&#39;,&#39;Coquimbo&#39;,&#39;Valparaíso&#39;,&#39;Metropolitana&#39;,&#39;O’Higgins&#39;,&#39;Maule&#39;,&#39;Ñuble&#39;,&#39;Biobío&#39;,&#39;Araucanía&#39;,&#39;Los Ríos&#39;,&#39;Los Lagos&#39;,&#39;Aysén&#39;,&#39;Magallanes&#39;]</span>
<span class="sd">    cut =   [&#39;15&#39;,                &#39;01&#39;,      &#39;02&#39;,         &#39;03&#39;,     &#39;04&#39;,      &#39;05&#39;,        &#39;13&#39;,           &#39;06&#39;,       &#39;07&#39;,   &#39;16&#39;,   &#39;08&#39;,    &#39;09&#39;,       &#39;14&#39;,      &#39;10&#39;,       &#39;11&#39;,   &#39;12&#39;] </span>

<span class="sd">    nametocut = {}  </span>
<span class="sd">    cuttoname = {} </span>
<span class="sd">    for i in range(len(Names)): </span>
<span class="sd">        nametocut.update({Names[i]:cut[i]})  </span>
<span class="sd">        cuttoname.update({cut[i]:Names[i]})         </span>

<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="help"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.help">[docs]</a><span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Functions: </span>

<span class="s2">          &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span></div>

<div class="viewcode-block" id="dataretriever"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.dataretriever">[docs]</a><span class="k">def</span> <span class="nf">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Esta funcion devolvera una funcion de request        </span>
    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.cv19gm.org/&#39;</span><span class="o">+</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">aux</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Wrong Credentials&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logged in successfully&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">json</span><span class="p">:</span>                
                <span class="n">aux</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">json</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://192.168.2.223:5006/&#39;</span><span class="o">+</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://192.168.2.223:5006/&#39;</span><span class="o">+</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aux</span>
    <span class="k">return</span> <span class="n">request</span></div>


<div class="viewcode-block" id="dfappend"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.dfappend">[docs]</a><span class="k">def</span> <span class="nf">dfappend</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">days</span><span class="p">,</span><span class="n">dataname</span><span class="p">):</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
    <span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">days</span><span class="p">:</span>
        <span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
    <span class="n">auxdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">dataname</span><span class="p">:</span><span class="n">aux</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">auxdf</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImportData"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData">[docs]</a><span class="k">class</span> <span class="nc">ImportData</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DLab Import Data Library</span>
<span class="sd">        input: </span>
<span class="sd">            - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">            - initdate: [datetime object] Initial date</span>
<span class="sd">        output:</span>
<span class="sd">            - ImportData Object.</span>

<span class="sd">        Usage Example: </span>
<span class="sd">        a = ImportData(tstate=&#39;13&#39;, initdate=datetime(2020,5,15))</span>
<span class="sd">        a.importdata()</span>

<span class="sd">         </span>
<span class="sd">        aux = requests.get(&#39;https://api.cv19gm.org/getComunas&#39;, auth=HTTPBasicAuth(&#39;afosr&#39;, &#39;5pI50sOjPTDlpH&#39;)) </span>
<span class="sd">        data = aux.json()</span>
<span class="sd">        # Para usarlo como dataframe de pandas</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        Data = pd.DataFrame(data)</span>

<span class="sd">        # For debugging in terminal:</span>

<span class="sd">        import json</span>
<span class="sd">        import requests</span>
<span class="sd">        from requests.auth import HTTPBasicAuth</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        from datetime import datetime</span>
<span class="sd">        from datetime import timedelta</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        from os import path        </span>
<span class="sd">        from importdata import ImportData</span>

<span class="sd">        state = &#39;13&#39;</span>
<span class="sd">        initdate = datetime(2020,5,15)</span>

<span class="sd">        data = ImportData(state,initdate, user, password)</span>


<span class="sd">        Todo: Add enddate</span>
<span class="sd">        Todo: Opción de guardar data en un archivo csv</span>
<span class="sd">        Todo: Opción de cargar data desde un archivo csv</span>

<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tstate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span><span class="n">user</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">password</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">localdata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">localdata</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">localdata</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">localdata</span><span class="p">)</span>
                <span class="c1">#self.load(localdata)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">localdata</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">localdata</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataError</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tdelta</span> <span class="o">=</span> <span class="n">enddate</span> <span class="o">-</span> <span class="n">initdate</span> 
            <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">initdate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tdelta</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span> 
            <span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tdelta</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;days&#39;</span><span class="p">:</span><span class="n">days</span><span class="p">,</span><span class="s1">&#39;dates&#39;</span><span class="p">:</span><span class="n">dates</span><span class="p">})</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span> <span class="o">=</span> <span class="n">tstate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span> <span class="o">=</span> <span class="n">initdate</span>
        
        <span class="c1"># this 2 must be deleted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.cv19gm.org/getComunas&#39;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">aux</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Wrong Credentials&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">aux</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logged in succesfully&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logging status_Code: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>

    <span class="c1"># --------------------------- #</span>
    <span class="c1">#    Importar toda la data    #</span>
    <span class="c1"># --------------------------- #</span>

<div class="viewcode-block" id="ImportData.import_data"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.import_data">[docs]</a>    <span class="k">def</span> <span class="nf">import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing general data&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_population</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dlab Endpoint Error&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_population_mcyt</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_active</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dlab Endpoint Error&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_active_mcyt</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_accumulated</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dlab Endpoint Error&#39;</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_accumulated_mcyt</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_daily</span><span class="p">()</span>
        <span class="c1">#self.importSOCHIMI()</span>
        <span class="c1">#self.importSOCHIMIMinCiencia()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_hosp_icu</span><span class="p">()</span>
        <span class="c1">#self.importAccumulatedDeaths()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_deaths_deis</span><span class="p">()</span>
        <span class="c1">#self.importActiveInfectedMinciencia()</span>

        <span class="c1">#self.importDeathsHospitalized()</span>
        <span class="c1">#self.importInfectedSubreport()</span>
        <span class="c1">#self.importpcrpop()        </span>
        <span class="c1">#self.importfallecidosexcesivos()        </span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImportData.import_data_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.import_data_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">import_data_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing data from MCYT github&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_population_mcyt</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_active_mcyt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_accumulated_mcyt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_daily_mcyt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_deaths_deis_mcyt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_hosp_icu</span><span class="p">()</span>
                
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span></div>

    <span class="c1"># ---------------------------- #</span>
    <span class="c1">#    Importar data para SEIR   #</span>
    <span class="c1"># ---------------------------- #</span>

<div class="viewcode-block" id="ImportData.import_data_seir"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.import_data_seir">[docs]</a>    <span class="k">def</span> <span class="nf">import_data_seir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing data for SEIR model&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_population</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dlab Endpoint Error&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_population_mcyt</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_active</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dlab Endpoint Error&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_active_mcyt</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_accumulated</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dlab Endpoint Error&#39;</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_accumulated_mcyt</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_daily</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dlab Endpoint Error&#39;</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_infected_daily_mcyt</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span></div>


    <span class="c1"># -------------------------- #</span>
    <span class="c1">#            Plot            #</span>
    <span class="c1"># -------------------------- #</span>
<div class="viewcode-block" id="ImportData.plot"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;dates&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">thickness</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">plottype</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="c1"># Drop na values</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">fmt_xdata</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
                    <span class="n">auxdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">auxdata</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="s1">&#39; data&#39;</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">auxdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>   
                <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">auxdata</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39; data&#39;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">plottype</span> <span class="o">==</span> <span class="s1">&#39;scatter&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
                    <span class="n">auxdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">auxdata</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="s1">&#39; data&#39;</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">auxdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>   
                <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">auxdata</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39; data&#39;</span><span class="p">)</span>  
        <span class="k">if</span> <span class="n">xlabel</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">fmt_xdata</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>        
        <span class="k">return</span></div>

    <span class="c1"># ---------------------------- #</span>
    <span class="c1">#         Save Data            #</span>
    <span class="c1"># ---------------------------- #</span>
<div class="viewcode-block" id="ImportData.save"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span></div>

    <span class="c1"># ---------------------------- #</span>
    <span class="c1">#         Load Data            #</span>
    <span class="c1"># ---------------------------- #</span>
<div class="viewcode-block" id="ImportData.load"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="c1"># Drop na values</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># Process the data - create de corresponding variables and dataframes:</span>
        <span class="k">return</span></div>


    <span class="c1"># ------------------------------ #</span>
    <span class="c1">#       Add Data Manually        #</span>
    <span class="c1"># ------------------------------ #</span>
<div class="viewcode-block" id="ImportData.add_data"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.add_data">[docs]</a>    <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">days</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">initdate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Data&#39;</span><span class="p">)</span>
        <span class="c1"># We use initdate in the case they give a days vector and it doesn&#39;t fit the actual data size        </span>
        
        
        
        <span class="k">return</span></div>

    <span class="c1"># -------------------------------- #</span>
    <span class="c1">#            Population            #</span>
    <span class="c1"># -------------------------------- #</span>

<div class="viewcode-block" id="ImportData.imp_population"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_population">[docs]</a>    <span class="k">def</span> <span class="nf">imp_population</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import PopulationendpointComunas</span>
<span class="sd">            This Function imports the selected area population. </span>

<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - endpoint [string](opcional)</span>
<span class="sd">            output:</span>
<span class="sd">                - population [int] </span>

<span class="sd">            object variables:</span>
<span class="sd">                self.population</span>
<span class="sd">                self.population_male</span>
<span class="sd">                self.population_female</span>

<span class="sd">            Example usage as function:</span>
<span class="sd">            population = importPopulation(tstate = &#39;13101&#39;,initdate=datetime(2020,5,15))                </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Population&#39;</span><span class="p">)</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>


        <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;getComunas&#39;</span>
    
        <span class="c1">#if not self.credentials:</span>
        <span class="c1">#    county = pd.read_json(endpointComunas)</span>

        <span class="c1">#else:</span>
        <span class="c1">#    aux = requests.get(&#39;https://api.cv19gm.org/getComunas&#39;, auth=HTTPBasicAuth(self.user, self.password))</span>
        <span class="c1">#    county = pd.DataFrame(aux.json())</span>

        <span class="n">county</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">population</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">population_male</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">population_female</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>                    
                    <span class="n">population</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;total_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                    <span class="n">population_male</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;male_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                    <span class="n">population_female</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;female_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">population</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;total_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                    <span class="n">population_male</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;male_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                    <span class="n">population_female</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;female_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>         
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">population</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tstate</span><span class="p">][</span><span class="s1">&#39;total_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">population_male</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tstate</span><span class="p">][</span><span class="s1">&#39;male_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">population_female</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tstate</span><span class="p">][</span><span class="s1">&#39;female_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">population</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tstate</span><span class="p">][</span><span class="s1">&#39;total_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">population_male</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tstate</span><span class="p">][</span><span class="s1">&#39;male_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">population_female</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tstate</span><span class="p">][</span><span class="s1">&#39;female_pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>                        
               
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">population</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">population_male</span> <span class="o">=</span> <span class="n">population_male</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">population_female</span> <span class="o">=</span> <span class="n">population_female</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">population</span></div>

<div class="viewcode-block" id="ImportData.imp_population_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_population_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_population_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto1/Covid-19.csv&#39;</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Population</span>
<span class="sd">            This Function imports the selected area population from the Minciencia Github Repository </span>

<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - endpoint [string](opcional)</span>
<span class="sd">            output:</span>
<span class="sd">                - population [int] </span>

<span class="sd">            Variables when used as Object:</span>
<span class="sd">                self.population</span>

<span class="sd">            Usage as function:</span>
<span class="sd">            population = importPopulationMinCiencia(tstate = &#39;13101&#39;,initdate=datetime(2020,5,15))</span>

<span class="sd">        &quot;&quot;&quot;</span>            
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Population&#39;</span><span class="p">)</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>

       
        <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>            

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">population</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">population</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">population</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">population</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">population</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">])</span>
               
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">population</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">population</span></div>

    <span class="c1"># -------------------------------- #</span>
    <span class="c1">#          Active Infected         #</span>
    <span class="c1"># -------------------------------- #</span>

<div class="viewcode-block" id="ImportData.imp_infected_active"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_active">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_active</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;getActiveCasesAllComunas&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Active infected</span>
<span class="sd">            This function imports the active infected calculated as the infected that are within their 14 days since exposure.</span>
<span class="sd">            </span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - endpoint (opcional):</span>
<span class="sd">                </span>
<span class="sd">            output: </span>
<span class="sd">                - Ir: list of Active infected </span>
<span class="sd">                - tr: days from simulation beginning</span>
<span class="sd">                - Ir_dates: dates [datetime object]</span>

<span class="sd">            Variables when used as Object:</span>
<span class="sd">                self.Ir</span>
<span class="sd">                self.tr</span>
<span class="sd">                self.Ir_dates</span>

<span class="sd">            Usage as function example:</span>
<span class="sd">                Ir,tr,Ir_dates = importActiveInfected(tstate = &#39;13101&#39;,initdate=datetime(2020,5,15))</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Active infected&#39;</span><span class="p">)</span>       
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>
        <span class="c1"># ---------------------- # </span>
        <span class="c1">#   Infectados Activos   #</span>
        <span class="c1"># ---------------------- #</span>

        <span class="c1">#if not self.credentials:</span>
        <span class="c1">#    data = pd.DataFrame(requests.get(endpoint).json()[&#39;data&#39;])</span>

        <span class="c1">#else:</span>
        <span class="c1">#    aux = requests.get(&#39;https://api.cv19gm.org/getActiveCasesAllComunas&#39;, auth=HTTPBasicAuth(self.user, self.password))</span>
        <span class="c1">#    data = pd.DataFrame(aux.json()[&#39;data&#39;])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="p">]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>            
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            
            <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">counties</span><span class="p">])</span>
            <span class="n">Ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">Ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">tstate</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">Ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">])</span>


        <span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;dates&#39;</span><span class="p">])</span>
        <span class="n">Ir_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ir_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>     
        <span class="n">Ir</span><span class="o">=</span><span class="n">Ir</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">Ir_dates</span><span class="o">=</span><span class="n">Ir_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Ir_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ir</span><span class="p">))]</span>

        
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Add data to Pandas DataFrame</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Ir</span><span class="p">,</span><span class="n">tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">Ir</span> <span class="o">=</span> <span class="n">Ir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ir_dates</span> <span class="o">=</span> <span class="n">Ir_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">=</span> <span class="n">tr</span>            
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">Ir</span><span class="p">,</span><span class="n">tr</span><span class="p">,</span><span class="n">Ir_dates</span></div>

    <span class="c1">#def importActiveInfectedMinciencia(self=None,tstate = &#39;&#39;,initdate=None,endpoint = &quot;&quot;):</span>
    <span class="c1"># ---------------------------------------- #</span>
    <span class="c1">#    Datos Infectados activos Minciencia   #</span>
    <span class="c1"># ---------------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_infected_active_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_active_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_active_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto19/CasosActivosPorComuna.csv&#39;</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span> <span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Active infected Minciencia</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - I_minciencia_r: Real acumulated deaths</span>
<span class="sd">                - I_minciencia_r_tr: days from simulation first day</span>
<span class="sd">                - I_minciencia_r_dates: data dates</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Active Infected by Minciencia&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>  

        <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>            
            <span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>            
            <span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">I_minciencia_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">I_minciencia_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">I_minciencia_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">I_minciencia_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


        <span class="c1">#self.I_minciencia_r = aux.loc[aux[&#39;Codigo region&#39;]==int(self.tstate[:2])].iloc[:,5:].sum()</span>
        

        <span class="n">I_minciencia_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">I_minciencia_r</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_minciencia_r</span><span class="p">))]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_minciencia_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">I_minciencia_r</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_minciencia_r_dates</span> <span class="o">=</span> <span class="n">I_minciencia_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_minciencia_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I_minciencia_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_minciencia_r</span><span class="p">))]</span>
        



        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">I_minciencia_r</span><span class="p">,</span><span class="n">I_minciencia_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">I_minciencia_r</span> <span class="o">=</span> <span class="n">I_minciencia_r</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_minciencia_r_dates</span> <span class="o">=</span> <span class="n">I_minciencia_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_minciencia_r_tr</span> <span class="o">=</span> <span class="n">I_minciencia_r_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">I_minciencia_r</span><span class="p">,</span> <span class="n">I_minciencia_r_tr</span><span class="p">,</span> <span class="n">I_minciencia_r_dates</span> </div>


    <span class="c1"># -------------------------------- #</span>
    <span class="c1">#      Accumulated Infected        #</span>
    <span class="c1"># -------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_infected_accumulated"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_accumulated">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;getTotalCasesAllComunas&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;I_ac&#39;</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import acumulated infected</span>
<span class="sd">            This Function imports the selected area accumulated infected from CyV Endpoint</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (opcional): </span>
<span class="sd">            output: </span>
<span class="sd">                - I_ac_r: Real Acumulated infected</span>
<span class="sd">                - I_ac_r_tr: days from simulation first day</span>
<span class="sd">                - I_ac_r_dates: data dates</span>

<span class="sd">            Variables when used as Object:</span>
<span class="sd">                self.I_ac_r</span>
<span class="sd">                self.I_ac_r_tr</span>
<span class="sd">                self.I_ac_r_dates</span>

<span class="sd">            Usage as function:</span>
<span class="sd">                I_ac_r, I_ac_r_tr,I_ac_r_dates= importAccumulatedInfected(tstate = &#39;13101&#39;,initdate=datetime(2020,5,15))</span>

<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Accumulated Infected&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>


        
        <span class="c1">#endPointTotal = &#39;http://192.168.2.223:5006/getTotalCasesAllComunas&#39;</span>
        <span class="c1">#data = pd.DataFrame(requests.get(endpoint).json()[&#39;data&#39;])</span>

        <span class="c1">#if not self.credentials:</span>
        <span class="c1">#    data = pd.DataFrame(requests.get(endpoint).json()[&#39;data&#39;])</span>

        <span class="c1">#else:</span>
        <span class="c1">#    aux = requests.get(&#39;https://api.cv19gm.org/getTotalCasesAllComunas&#39;, auth=HTTPBasicAuth(self.user, self.password))</span>
        <span class="c1">#    data = pd.DataFrame(aux.json()[&#39;data&#39;])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="p">]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>            
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            
            <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">counties</span><span class="p">])</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">tstate</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">])</span>

        <span class="c1"># Get and filter by dates</span>
        
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">i</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>        
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_ac_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">))]</span>        


        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">I_ac_r</span><span class="p">,</span><span class="n">I_ac_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="n">I_ac_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_ac_r_tr</span> <span class="o">=</span> <span class="n">I_ac_r_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">I_ac_r</span><span class="p">,</span><span class="n">I_ac_r_tr</span><span class="p">,</span><span class="n">I_ac_r_dates</span></div>


<div class="viewcode-block" id="ImportData.imp_infected_accumulated_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_accumulated_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_accumulated_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto1/Covid-19.csv&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;I_ac&#39;</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import acumulated infected</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (opcional): </span>
<span class="sd">            output: </span>
<span class="sd">                - I_ac_r: Real Acumulated infected</span>
<span class="sd">                - I_ac_r_tr: days from simulation first day</span>
<span class="sd">                - I_ac_r_dates: data dates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Accumulated Infected&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>            
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>            
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>                        
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">I_ac_r</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">))]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_ac_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">))]</span>     

         
               
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">I_ac_r</span><span class="p">,</span><span class="n">I_ac_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>              
            <span class="bp">self</span><span class="o">.</span><span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="n">I_ac_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_ac_r_tr</span> <span class="o">=</span> <span class="n">I_ac_r_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">),</span><span class="n">I_ac_r_tr</span><span class="p">,</span><span class="n">I_ac_r_dates</span></div>

    <span class="c1"># -------------------------------- #</span>
    <span class="c1">#      Daily infected Smoothed     #</span>
    <span class="c1"># -------------------------------- #</span>
    <span class="c1"># Created by Felipe Castillo</span>
<div class="viewcode-block" id="ImportData.imp_infected_daily"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_daily">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_daily</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;getTotalCasesAllComunas&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;I_d&#39;</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import daily infected</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - I_d_r: Real Daily infected</span>
<span class="sd">                - I_d_r_tr: days from simulation first day</span>
<span class="sd">                - I_d_r_dates: data dates</span>
<span class="sd">            usage </span>
<span class="sd">                I_d_r, I_d_r_tr, I_d_r_dates = importDailyInfected(tstate = &#39;13101&#39;,initdate = datetime(2020,5,15))      </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">endpoint_counties</span> <span class="o">=</span> <span class="s1">&#39;getNewCasesAllCounties&#39;</span>
        <span class="n">endpoint_regions</span> <span class="o">=</span> <span class="s1">&#39;getNewCasesAllStates&#39;</span>
        <span class="n">endpoint_national</span> <span class="o">=</span> <span class="s1">&#39;getNationalNewCases&#39;</span>

        <span class="c1">#print(&#39;Importing Daily Infected&#39;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>


        <span class="c1">#data = pd.DataFrame(request(endpoint).json()[&#39;data&#39;])</span>
        <span class="c1">#dates = pd.DataFrame(request(endpoint).json()[&#39;dates&#39;])[0]</span>

        <span class="c1"># Multiple data</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="p">]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>            
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">auxdata</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">endpoint_counties</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            
            <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">counties</span><span class="p">])</span>
            <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        

        <span class="c1"># Single data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># National</span>
            <span class="k">if</span> <span class="n">tstate</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">or</span> <span class="n">tstate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">auxdata</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">endpoint_national</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;cases&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Regions                </span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">auxdata</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">endpoint_regions</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])[</span><span class="n">tstate</span><span class="p">]</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>                
                
            <span class="c1"># Counties</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">auxdata</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">endpoint_counties</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])[</span><span class="n">tstate</span><span class="p">]</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxdata</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                

        <span class="c1"># Get and filter by dates</span>
        
        <span class="n">I_d_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">i</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_d_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">I_d_r</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_d_dates</span> <span class="o">=</span> <span class="n">I_d_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_d_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I_d_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">))]</span>        




        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="c1">#print(&#39;updating database&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">I_d_r</span><span class="p">,</span><span class="n">I_d_tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>             
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_tr</span> <span class="o">=</span> <span class="n">I_d_tr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="n">I_d_dates</span>

            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">),</span> <span class="n">I_d_tr</span><span class="p">,</span> <span class="n">I_d_dates</span></div>
                
    <span class="c1"># ------------------------------------------ #</span>
    <span class="c1">#      Daily infected Smoothed MinCiencia    #</span>
    <span class="c1"># ------------------------------------------ #</span>
    <span class="c1"># Created by Felipe Castillo</span>
<div class="viewcode-block" id="ImportData.imp_infected_daily_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_daily_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_daily_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto1/Covid-19.csv&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;I_d&#39;</span> <span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import daily infected</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - I_d_r: Real Daily infected</span>
<span class="sd">                - I_d_r_tr: days from simulation first day</span>
<span class="sd">                - I_d_r_dates: data dates</span>
<span class="sd">            usage </span>
<span class="sd">                I_d_r, I_d_r_tr, I_d_r_dates = importDailyInfected(tstate = &#39;13101&#39;,initdate = datetime(2020,5,15))      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#print(&#39;Importing Daily Infected&#39;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
                        
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>            
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>            
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>                        
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">I_ac_r</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">))]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_ac_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">))]</span>    

        <span class="c1"># Create daily infected from Interpolating and diferentiating the acumulated infected</span>
        <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">I_ac_r_tr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="n">I_ac_r_tr</span><span class="p">,</span><span class="n">I_ac_r</span><span class="p">))</span>
        <span class="n">I_d_r_tr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">)))</span>
        <span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">initdate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_d_r_tr</span><span class="p">))]</span>

        <span class="k">if</span> <span class="n">initdate</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">):</span>
            <span class="n">outliers_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="n">outliers_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

        <span class="n">I_d_r_smooth</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">initdate</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">):</span>
            <span class="n">I_d_r_smooth</span><span class="p">[</span><span class="n">outliers_init</span><span class="p">:</span><span class="n">outliers_end</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">I_d_r_smooth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">outliers_init</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">I_d_r_smooth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">outliers_end</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">I_d_r_smooth</span> <span class="o">=</span> <span class="n">I_d_r_smooth</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">std</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

        
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_d_r_smooth</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">I_d_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>              
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_d_r_smooth</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_tr</span> <span class="o">=</span> <span class="n">I_d_r_tr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="n">I_d_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_raw</span> <span class="o">=</span> <span class="n">I_d_r</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_d_r_smooth</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">I_d_r_tr</span><span class="p">,</span> <span class="n">I_d_r_dates</span></div>



    <span class="c1"># -------------------------------------------------- #</span>
    <span class="c1">#       Daily infected Informe Diario Minciencia     #</span>
    <span class="c1"># -------------------------------------------------- #</span>

<div class="viewcode-block" id="ImportData.imp_infected_daily_national"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_daily_national">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_daily_national</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;getNationalNewCases&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;I_d&#39;</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import daily infected</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - I_d_r: Real Daily infected</span>
<span class="sd">                - I_d_r_tr: days from simulation first day</span>
<span class="sd">                - I_d_r_dates: data dates</span>
<span class="sd">            usage </span>
<span class="sd">                I_d_r, I_d_r_tr, I_d_r_dates = importDailyInfected(tstate = &#39;13101&#39;,initdate = datetime(2020,5,15))      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#print(&#39;Importing Daily Infected&#39;)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>


        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;cases&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>       


        <span class="c1"># Get and filter by dates               </span>
        <span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">timeJStoPy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>        

        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_d_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="n">I_d_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_d_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I_d_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">))]</span>       

                
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">I_d_r</span><span class="p">,</span><span class="n">I_d_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>               
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r</span> <span class="o">=</span> <span class="n">I_d_r</span><span class="c1">#np.array(I_d_r_smooth[0])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_tr</span> <span class="o">=</span> <span class="n">I_d_r_tr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="n">I_d_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_raw</span> <span class="o">=</span> <span class="n">I_d_r</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">I_d_r</span><span class="p">,</span> <span class="n">I_d_r_tr</span><span class="p">,</span> <span class="n">I_d_r_dates</span></div>
                
   

    <span class="c1"># ----------------------------------------------------- #</span>
    <span class="c1">#      Daily infected Smoothed with backpropagation     #</span>
    <span class="c1"># ----------------------------------------------------- #</span>
    <span class="c1"># Created by Felipe Castillo</span>
<div class="viewcode-block" id="ImportData.imp_infected_daily_mcyt_backprop"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_infected_daily_mcyt_backprop">[docs]</a>    <span class="k">def</span> <span class="nf">imp_infected_daily_mcyt_backprop</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto1/Covid-19.csv&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;I_d&#39;</span> <span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import daily infected smoothed with Backpropagation</span>
<span class="sd">            This function smoothes the daily infected thata and distributes homogeneously the 30k excess cases added in ~2020-6-16</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - I_d_r: Real Daily infected</span>
<span class="sd">                - I_d_r_tr: days from simulation first day</span>
<span class="sd">                - I_d_r_dates: data dates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#print(&#39;Importing Daily infected with backpropagated correction&#39;)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>            
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>            
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>                        
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;Codigo comuna&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">I_ac_r</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">))]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_ac_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">I_ac_r</span> <span class="o">=</span> <span class="n">I_ac_r</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_dates</span> <span class="o">=</span> <span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">I_ac_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I_ac_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_ac_r</span><span class="p">))]</span>    

        <span class="c1"># Create daily infected from Interpolating and diferentiating the acumulated infected</span>
        <span class="n">I_d_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">I_ac_r_tr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="n">I_ac_r_tr</span><span class="p">,</span><span class="n">I_ac_r</span><span class="p">))</span>
        <span class="n">I_d_r_tr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">)))</span>
        <span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">initdate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_d_r_tr</span><span class="p">))]</span>



        <span class="n">I_d_r_smooth</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">I_d_r</span><span class="p">)</span>

        <span class="n">outliers_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">outliers_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

        <span class="k">if</span> <span class="n">outliers_end</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">I_d_r_smooth</span><span class="p">[</span><span class="n">outliers_init</span><span class="p">:</span><span class="n">outliers_end</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">I_d_r_smooth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">outliers_init</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">I_d_r_smooth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">outliers_end</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">I_d_r_smooth</span><span class="p">[:</span><span class="n">outliers_end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">I_d_r_smooth</span><span class="p">[:</span><span class="n">outliers_end</span><span class="p">]</span><span class="o">*</span><span class="mi">31412</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I_d_r_smooth</span><span class="p">[:</span><span class="n">outliers_end</span><span class="p">]))</span>

        <span class="n">I_d_r_smooth</span> <span class="o">=</span> <span class="n">I_d_r_smooth</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">std</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>


        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">I_d_r_smooth</span><span class="p">,</span><span class="n">I_d_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>              
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r</span> <span class="o">=</span> <span class="n">I_d_r_smooth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_tr</span> <span class="o">=</span> <span class="n">I_d_r_tr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_d_r_dates</span> <span class="o">=</span> <span class="n">I_d_r_dates</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">I_d_r_smooth</span><span class="p">,</span> <span class="n">I_d_r_tr</span><span class="p">,</span> <span class="n">I_d_r_dates</span></div>
                
    
    <span class="c1"># --------------------------------------------------------- #</span>
    <span class="c1">#                 Ocupación Hospitalaria                    #</span>
    <span class="c1"># --------------------------------------------------------- #    </span>

    <span class="c1"># ------------------ #</span>
    <span class="c1">#    Datos Sochimi   #</span>
    <span class="c1"># ------------------ #</span>
<div class="viewcode-block" id="ImportData.imp_sochimi"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_sochimi">[docs]</a>    <span class="k">def</span> <span class="nf">imp_sochimi</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;getBedsAndVentilationByState?state=&quot;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import SOCHIMI data per state.</span>
<span class="sd">        Currently it just supports states, but soon I&#39;ll add Health Services as the minimum territorial data.</span>
<span class="sd">        input:</span>
<span class="sd">            - tstate: región</span>
<span class="sd">            - initdate: Fecha de inicio</span>
<span class="sd">            - endpoint: Data endpoint</span>
<span class="sd">        output:</span>
<span class="sd">            - sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot, </span>
<span class="sd">             (data frame, fechas, dias desde inicio sim, Hospitalizados, capacidad hospitalizados, ventilados, capacidad ventilados) </span>
<span class="sd">        </span>
<span class="sd">        Normal Usage:</span>
<span class="sd">            sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot = importSOCHIMI(tstate = &#39;13&#39;, initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Sochimi Data&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="c1">#if not self.credentials:</span>
        <span class="c1">#    endpoint = endpoint+tstate[:2]</span>
        <span class="c1">#    r = requests.get(endpoint) </span>
        <span class="c1">#    sochimi=pd.DataFrame(r.json())</span>
            
        <span class="c1">#else:</span>
        <span class="c1">#    r = requests.get(&#39;https://api.cv19gm.org/getBedsAndVentilationByState?state=&#39;+tstate[:2], auth=HTTPBasicAuth(self.user, self.password))</span>
        <span class="c1">#    sochimi=pd.DataFrame(r.json())</span>

        <span class="n">sochimi</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="o">+</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
        
        <span class="n">Hr</span> <span class="o">=</span> <span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;camas_ocupadas&#39;</span><span class="p">]</span>
        <span class="n">Vr</span> <span class="o">=</span>  <span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;vmi_ocupados&#39;</span><span class="p">]</span>
        <span class="n">Vr_tot</span> <span class="o">=</span>  <span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;vmi_totales&#39;</span><span class="p">]</span>
        <span class="n">Vr_conf</span> <span class="o">=</span>  <span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;vmi_covid19_confirmados&#39;</span><span class="p">]</span>
        <span class="n">Vr_susp</span> <span class="o">=</span>  <span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;vmi_covid19_sospechosos&#39;</span><span class="p">]</span>
        <span class="n">Hr_tot</span> <span class="o">=</span>  <span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;camas_totales&#39;</span><span class="p">]</span>
        <span class="n">sochimi_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sochimi</span><span class="p">))]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sochimi_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">Hr</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">Hr</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">Vr</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">Vr</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">Hr_tot</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">Hr_tot</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">Vr_tot</span><span class="o">=</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Vr_tot</span><span class="p">[</span><span class="n">index</span><span class="p">:]))</span>
        <span class="n">sochimi_dates</span> <span class="o">=</span> <span class="n">sochimi_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">sochimi_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sochimi_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hr</span><span class="p">))]</span>
        <span class="n">sochimi</span> <span class="o">=</span> <span class="n">sochimi</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span> 
               

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sochimi</span> <span class="o">=</span> <span class="n">sochimi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hr</span> <span class="o">=</span> <span class="n">Hr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">=</span> <span class="n">Vr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vr_conf</span> <span class="o">=</span> <span class="n">Vr_conf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vr_susp</span> <span class="o">=</span> <span class="n">Vr_susp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vr_tot</span> <span class="o">=</span> <span class="n">Vr_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hr_tot</span> <span class="o">=</span> <span class="n">Hr_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sochimi_dates</span> <span class="o">=</span> <span class="n">sochimi_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sochimi_tr</span> <span class="o">=</span> <span class="n">sochimi_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">sochimi</span><span class="p">,</span><span class="n">sochimi_dates</span> <span class="p">,</span><span class="n">sochimi_tr</span><span class="p">,</span><span class="n">Hr</span><span class="p">,</span> <span class="n">Hr_tot</span><span class="p">,</span> <span class="n">Vr</span> <span class="p">,</span><span class="n">Vr_tot</span></div>



    <span class="c1"># ------------------ #</span>
    <span class="c1">#    Datos Sochimi   #</span>
    <span class="c1"># ------------------ #</span>
<div class="viewcode-block" id="ImportData.imp_sochimi_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_sochimi_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_sochimi_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto48/SOCHIMI.csv&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import SOCHIMI data per state.</span>
<span class="sd">        Currently it just supports states, but soon I&#39;ll add Health Services as the minimum territorial data.</span>
<span class="sd">        input:</span>
<span class="sd">            - tstate: región</span>
<span class="sd">            - initdate: Fecha de inicio</span>
<span class="sd">            - endpoint: Data endpoint</span>
<span class="sd">        output:</span>
<span class="sd">            - sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot, </span>
<span class="sd">             (data frame, fechas, dias desde inicio sim, Hospitalizados, capacidad hospitalizados, ventilados, capacidad ventilados) </span>
<span class="sd">        </span>
<span class="sd">        Normal Usage:</span>
<span class="sd">            sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot = importSOCHIMI(tstate = &#39;13&#39;, initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Sochimi Data 2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">sochimi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>

        <span class="n">sochimi</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)]</span>

        <span class="n">UTI</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Camas ocupadas intermedio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">UTI_tot</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Camas totales intermedio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">UCI</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Camas ocupadas intensivo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">UCI_tot</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Camas totales intensivo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        
        <span class="n">VMI</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vmi ocupados&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">VMI_tot</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vmi totales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">VMI_sospechoso</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vmi covid19 sospechosos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">VMI_confirmado</span> <span class="o">=</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sochimi</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vmi covid19 confirmados&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        
        <span class="n">sochimi_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">sochimi</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sochimi</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))]</span>        
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sochimi_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 

        
        <span class="n">UCI</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">UCI</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UCI_tot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">UCI_tot</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UTI</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">UTI</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UTI_tot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">UTI_tot</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>

        <span class="n">VMI</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">VMI</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">VMI_tot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">VMI_tot</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">VMI_sospechoso</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">VMI_sospechoso</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">VMI_confirmado</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">VMI_confirmado</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>

        <span class="n">sochimi_dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sochimi_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">sochimi_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sochimi_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sochimi_dates</span><span class="p">))]</span>
        <span class="n">sochimi</span> <span class="o">=</span> <span class="n">sochimi</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span> 

        <span class="n">Hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">UCI</span><span class="p">)</span> <span class="c1">#+ np.array(UTI)</span>
        <span class="n">Hr_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">UCI_tot</span><span class="p">)</span><span class="c1"># + np.array(UTI_tot)</span>
        
               
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI</span> <span class="o">=</span> <span class="n">UCI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_tot</span> <span class="o">=</span> <span class="n">UCI_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UTI</span> <span class="o">=</span> <span class="n">UTI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UTI_tot</span> <span class="o">=</span> <span class="n">UTI_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VMI</span> <span class="o">=</span> <span class="n">VMI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VMI_tot</span> <span class="o">=</span> <span class="n">VMI_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VMI_sospechoso</span> <span class="o">=</span> <span class="n">VMI_sospechoso</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VMI_confirmado</span> <span class="o">=</span> <span class="n">VMI_confirmado</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sochimi_dates</span> <span class="o">=</span> <span class="n">sochimi_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sochimi_tr</span> <span class="o">=</span> <span class="n">sochimi_tr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sochimi</span> <span class="o">=</span> <span class="n">sochimi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hr</span> <span class="o">=</span> <span class="n">Hr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hr_tot</span> <span class="o">=</span> <span class="n">Hr_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">=</span> <span class="n">VMI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vr_tot</span> <span class="o">=</span> <span class="n">VMI_tot</span>

            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">UCI</span><span class="p">,</span> <span class="n">UCI_tot</span><span class="p">,</span> <span class="n">UTI</span><span class="p">,</span> <span class="n">UTI_tot</span><span class="p">,</span> <span class="n">VMI</span><span class="p">,</span> <span class="n">VMI_tot</span><span class="p">,</span> <span class="n">VMI_sospechoso</span><span class="p">,</span> <span class="n">VMI_confirmado</span><span class="p">,</span> <span class="n">sochimi_dates</span><span class="p">,</span> <span class="n">sochimi_tr</span><span class="p">,</span> <span class="n">sochimi</span><span class="p">,</span> <span class="n">Hr</span><span class="p">,</span> <span class="n">Hr_tot</span></div>


    <span class="c1"># ----------------------------- #</span>
    <span class="c1">#    Datos Ocupacion de Camas   #</span>
    <span class="c1"># ----------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_hosp_icu"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_hosp_icu">[docs]</a>    <span class="k">def</span> <span class="nf">imp_hosp_icu</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;getRegionalIcuBedOccupation&quot;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UCI_capacity&#39;</span><span class="p">,</span><span class="s1">&#39;UCI_use_covid&#39;</span><span class="p">,</span><span class="s1">&#39;UCI_use_noncovid&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import ICU Bed Occupation data per region.</span>
<span class="sd">        Currently it just supports states, but soon I&#39;ll add Health Services as the minimum territorial data.</span>
<span class="sd">        input:</span>
<span class="sd">            - tstate: región</span>
<span class="sd">            - initdate: Fecha de inicio</span>
<span class="sd">            - endpoint: Data endpoint</span>
<span class="sd">        output:</span>
<span class="sd">            - sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot, </span>
<span class="sd">             (data frame, fechas, dias desde inicio sim, Hospitalizados, capacidad hospitalizados, ventilados, capacidad ventilados) </span>
<span class="sd">        </span>
<span class="sd">        Normal Usage:</span>
<span class="sd">            sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot = importSOCHIMI(tstate = &#39;13&#39;, initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing ICU Beds Data&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>


        <span class="c1">#if not self.credentials:</span>
        <span class="c1">#    endpoint = endpoint+tstate[:2]</span>
        <span class="c1">#    r = requests.get(endpoint) </span>
        <span class="c1">#    sochimi=pd.DataFrame(r.json())</span>
            
        <span class="c1">#else:</span>
        <span class="c1">#    r = requests.get(&#39;https://api.cv19gm.org/getBedsAndVentilationByState?state=&#39;+tstate[:2], auth=HTTPBasicAuth(self.user, self.password))</span>
        <span class="c1">#    sochimi=pd.DataFrame(r.json())</span>


        <span class="n">aux</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#sochimi=pd.DataFrame(request(endpoint+tstate[:2]).json())</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1">#counties = [i for i in tstate if len(i)&gt;2 ]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>            
            <span class="n">capacity</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">occupied_covid</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">occupied_non_covid</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">capacity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;capacity&#39;</span><span class="p">])</span>
                <span class="n">occupied_covid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;occupied_covid&#39;</span><span class="p">])</span>
                <span class="n">occupied_non_covid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;occupied_non_covid&#39;</span><span class="p">])</span>
            
             
            <span class="n">capacity</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">capacity</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">occupied_covid</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occupied_covid</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">occupied_non_covid</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occupied_non_covid</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 


        <span class="k">else</span><span class="p">:</span>
            <span class="n">capacity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span>
            <span class="n">occupied_covid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;occupied_covid&#39;</span><span class="p">]</span>
            <span class="n">occupied_non_covid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;occupied_non_covid&#39;</span><span class="p">]</span>


        <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))]</span>        
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 

        <span class="n">UCI_capacity</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">capacity</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UCI_use_covid</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">occupied_covid</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UCI_use_noncovid</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">occupied_non_covid</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>

        <span class="n">UCI_dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">UCI_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">UCI_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">UCI_dates</span><span class="p">))]</span>       
               
       
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_capacity</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_use_covid</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_use_noncovid</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>              
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_capacity</span> <span class="o">=</span> <span class="n">UCI_capacity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_use_covid</span> <span class="o">=</span> <span class="n">UCI_use_covid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_use_noncovid</span> <span class="o">=</span> <span class="n">UCI_use_noncovid</span>                        
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_dates</span> <span class="o">=</span> <span class="n">UCI_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_tr</span> <span class="o">=</span> <span class="n">UCI_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">UCI_capacity</span><span class="p">,</span><span class="n">UCI_use_covid</span><span class="p">,</span><span class="n">UCI_use_noncovid</span><span class="p">,</span><span class="n">UCI_dates</span><span class="p">,</span><span class="n">UCI_tr</span></div>



    <span class="c1"># ----------------------------- #</span>
    <span class="c1">#    Datos Ocupacion de Camas   #</span>
    <span class="c1"># ----------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_hosp_icu_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_hosp_icu_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_hosp_icu_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto58/Camas_UCI_diarias.csv&quot;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UCI_capacity&#39;</span><span class="p">,</span><span class="s1">&#39;UCI_use_covid&#39;</span><span class="p">,</span><span class="s1">&#39;UCI_use_noncovid&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import ICU Bed Occupation data per region.</span>
<span class="sd">        Currently it just supports states, but soon I&#39;ll add Health Services as the minimum territorial data.</span>
<span class="sd">        input:</span>
<span class="sd">            - tstate: región</span>
<span class="sd">            - initdate: Fecha de inicio</span>
<span class="sd">            - endpoint: Data endpoint</span>
<span class="sd">        output:</span>
<span class="sd">            - sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot, </span>
<span class="sd">             (data frame, fechas, dias desde inicio sim, Hospitalizados, capacidad hospitalizados, ventilados, capacidad ventilados) </span>
<span class="sd">        </span>
<span class="sd">        Normal Usage:</span>
<span class="sd">            sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot = importSOCHIMI(tstate = &#39;13&#39;, initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cuttoname</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;15&#39;</span><span class="p">:</span> <span class="s1">&#39;Arica y Parinacota&#39;</span><span class="p">,</span> <span class="s1">&#39;01&#39;</span><span class="p">:</span> <span class="s1">&#39;Tarapacá&#39;</span><span class="p">,</span> <span class="s1">&#39;02&#39;</span><span class="p">:</span> <span class="s1">&#39;Antofagasta&#39;</span><span class="p">,</span> <span class="s1">&#39;03&#39;</span><span class="p">:</span> <span class="s1">&#39;Atacama&#39;</span><span class="p">,</span> <span class="s1">&#39;04&#39;</span><span class="p">:</span> <span class="s1">&#39;Coquimbo&#39;</span><span class="p">,</span> <span class="s1">&#39;05&#39;</span><span class="p">:</span> <span class="s1">&#39;Valparaíso&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">:</span> <span class="s1">&#39;Metropolitana&#39;</span><span class="p">,</span> <span class="s1">&#39;06&#39;</span><span class="p">:</span> <span class="s1">&#39;O’Higgins&#39;</span><span class="p">,</span> <span class="s1">&#39;07&#39;</span><span class="p">:</span> <span class="s1">&#39;Maule&#39;</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">:</span> <span class="s1">&#39;Ñuble&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">:</span> <span class="s1">&#39;Biobío&#39;</span><span class="p">,</span> <span class="s1">&#39;09&#39;</span><span class="p">:</span> <span class="s1">&#39;Araucanía&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">:</span> <span class="s1">&#39;Los Ríos&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="s1">&#39;Los Lagos&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">:</span> <span class="s1">&#39;Aysén&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">:</span> <span class="s1">&#39;Magallanes&#39;</span><span class="p">}</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        
        <span class="p">[</span><span class="s1">&#39;Camas UCI habilitadas&#39;</span><span class="p">,</span><span class="s1">&#39;Camas UCI ocupadas COVID-19&#39;</span><span class="p">,</span><span class="s1">&#39;Camas UCI ocupadas no COVID-19&#39;</span><span class="p">]</span>
        

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="p">[</span><span class="n">tstate</span><span class="p">]</span>
            
        <span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">counties</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This method doesn</span><span class="se">\&#39;</span><span class="s1">t support comunas for Chile&#39;</span><span class="p">)</span>
        
        <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>
        <span class="n">statenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">cuttoname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">]</span>

        <span class="n">capacity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">occupied_covid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">occupied_non_covid</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">statenames</span><span class="p">:</span>
            <span class="n">capacity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Camas UCI habilitadas&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:])</span>
            <span class="n">occupied_covid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Camas UCI ocupadas COVID-19&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:])</span>
            <span class="n">occupied_non_covid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Serie&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Camas UCI ocupadas no COVID-19&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:])</span>
        
            
        <span class="n">capacity</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">capacity</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
        <span class="n">occupied_covid</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occupied_covid</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
        <span class="n">occupied_non_covid</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occupied_non_covid</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 

        <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))]</span>        
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 

        <span class="n">UCI_capacity</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">capacity</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UCI_use_covid</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">occupied_covid</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UCI_use_noncovid</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">occupied_non_covid</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>

        <span class="n">UCI_dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">UCI_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">UCI_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">UCI_dates</span><span class="p">))]</span>               
       
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_capacity</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_use_covid</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_use_noncovid</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>              
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_capacity</span> <span class="o">=</span> <span class="n">UCI_capacity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_use_covid</span> <span class="o">=</span> <span class="n">UCI_use_covid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_use_noncovid</span> <span class="o">=</span> <span class="n">UCI_use_noncovid</span>                        
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_dates</span> <span class="o">=</span> <span class="n">UCI_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_tr</span> <span class="o">=</span> <span class="n">UCI_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">UCI_capacity</span><span class="p">,</span><span class="n">UCI_use_covid</span><span class="p">,</span><span class="n">UCI_use_noncovid</span><span class="p">,</span><span class="n">UCI_dates</span><span class="p">,</span><span class="n">UCI_tr</span></div>




    <span class="c1"># ---------------------------------------------- #</span>
    <span class="c1">#    Datos Ocupacion de Camas y Ventiladores     #</span>
    <span class="c1"># ---------------------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_hosp_vmibeds"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_hosp_vmibeds">[docs]</a>    <span class="k">def</span> <span class="nf">imp_hosp_vmibeds</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;getRegionalIcuBedOccupation&quot;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UCI_capacity&#39;</span><span class="p">,</span><span class="s1">&#39;UCI_use_covid&#39;</span><span class="p">,</span><span class="s1">&#39;UCI_use_noncovid&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import ICU Bed Occupation data per region.</span>
<span class="sd">        Currently it just supports states, but soon I&#39;ll add Health Services as the minimum territorial data.</span>
<span class="sd">        input:</span>
<span class="sd">            - tstate: región</span>
<span class="sd">            - initdate: Fecha de inicio</span>
<span class="sd">            - endpoint: Data endpoint</span>
<span class="sd">        output:</span>
<span class="sd">            - sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot, </span>
<span class="sd">             (data frame, fechas, dias desde inicio sim, Hospitalizados, capacidad hospitalizados, ventilados, capacidad ventilados) </span>
<span class="sd">        </span>
<span class="sd">        Normal Usage:</span>
<span class="sd">            sochimi, sochimi_dates, sochimi_tr, Hr, Hr_tot, Vr, Vr_tot = importSOCHIMI(tstate = &#39;13&#39;, initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">endpoint_nacional</span> <span class="o">=</span> <span class="s1">&#39;getAllBedsAndVentilation&#39;</span>
        <span class="n">endpoint_regional</span> <span class="o">=</span> <span class="s1">&#39;getBedsAndVentilationByState?state=&#39;</span>
        <span class="n">endpoint_comunal</span> <span class="o">=</span> <span class="s1">&#39;getBedsAndVentilationByComuna?comuna=&#39;</span>
        <span class="n">endpoint_ssalud</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Hospitalization Data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>


        <span class="c1">#if not self.credentials:</span>
        <span class="c1">#    endpoint = endpoint+tstate[:2]</span>
        <span class="c1">#    r = requests.get(endpoint) </span>
        <span class="c1">#    sochimi=pd.DataFrame(r.json())</span>
            
        <span class="c1">#else:</span>
        <span class="c1">#    r = requests.get(&#39;https://api.cv19gm.org/getBedsAndVentilationByState?state=&#39;+tstate[:2], auth=HTTPBasicAuth(self.user, self.password))</span>
        <span class="c1">#    sochimi=pd.DataFrame(r.json())</span>


        <span class="n">aux</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#sochimi=pd.DataFrame(request(endpoint+tstate[:2]).json())</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1">#counties = [i for i in tstate if len(i)&gt;2 ]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>            
            <span class="n">capacity</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">occupied_covid</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">occupied_non_covid</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">capacity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;capacity&#39;</span><span class="p">])</span>
                <span class="n">occupied_covid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;occupied_covid&#39;</span><span class="p">])</span>
                <span class="n">occupied_non_covid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;occupied_non_covid&#39;</span><span class="p">])</span>
            
             
            <span class="n">capacity</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">capacity</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">occupied_covid</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occupied_covid</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">occupied_non_covid</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occupied_non_covid</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 


        <span class="k">else</span><span class="p">:</span>
            <span class="n">capacity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span>
            <span class="n">occupied_covid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;occupied_covid&#39;</span><span class="p">]</span>
            <span class="n">occupied_non_covid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;occupied_non_covid&#39;</span><span class="p">]</span>


        <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))]</span>        
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 

        <span class="n">UCI_capacity</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">capacity</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UCI_use_covid</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">occupied_covid</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">UCI_use_noncovid</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">occupied_non_covid</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>

        <span class="n">UCI_dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">UCI_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">UCI_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">UCI_dates</span><span class="p">))]</span>       
               

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_capacity</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_use_covid</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">UCI_use_noncovid</span><span class="p">,</span><span class="n">UCI_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_capacity</span> <span class="o">=</span> <span class="n">UCI_capacity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_use_covid</span> <span class="o">=</span> <span class="n">UCI_use_covid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_use_noncovid</span> <span class="o">=</span> <span class="n">UCI_use_noncovid</span>                        
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_dates</span> <span class="o">=</span> <span class="n">UCI_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UCI_tr</span> <span class="o">=</span> <span class="n">UCI_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">UCI_capacity</span><span class="p">,</span><span class="n">UCI_use_covid</span><span class="p">,</span><span class="n">UCI_use_noncovid</span><span class="p">,</span><span class="n">UCI_dates</span><span class="p">,</span><span class="n">UCI_tr</span></div>



    <span class="c1"># -------------------------------- #</span>
    <span class="c1">#    Datos Fallecidos acumulados   #</span>
    <span class="c1"># -------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_deaths_accumulated"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_deaths_accumulated">[docs]</a>    <span class="k">def</span> <span class="nf">imp_deaths_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;getMinsalDeathsByState?state=&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Acumulated Deaths - Regional</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - Br: Real acumulated deaths</span>
<span class="sd">                - Br_tr: days from simulation first day</span>
<span class="sd">                - Br_dates: data dates</span>
<span class="sd">            Usage:</span>
<span class="sd">                Br,Br_tr,Br_dates = importAcumulatedDeaths(self=None,tstate = &#39;13&#39;,initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Accumulated Deaths&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only regional data available&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>     
                
        <span class="n">tstate</span> <span class="o">=</span> <span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpoint</span><span class="o">+</span><span class="n">tstate</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>        
        
        <span class="n">Br</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;dates&#39;</span><span class="p">)</span>
        <span class="n">Br_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">]))]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Br_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">Br</span> <span class="o">=</span> <span class="n">Br</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">Br_dates</span> <span class="o">=</span> <span class="n">Br_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">Br_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Br_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Br</span><span class="p">))]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br</span> <span class="o">=</span> <span class="n">Br</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_dates</span> <span class="o">=</span> <span class="n">Br_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_tr</span> <span class="o">=</span> <span class="n">Br_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">Br</span><span class="p">,</span><span class="n">Br_tr</span><span class="p">,</span><span class="n">Br_dates</span></div>

    <span class="c1"># -------------------------------- #</span>
    <span class="c1">#    Datos Fallecidos acumulados   #</span>
    <span class="c1"># -------------------------------- #</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    def imp_deaths_accumulated_mcyt(self=None,tstate = &#39;&#39;,initdate = None, endpoint = &#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto14/FallecidosCumulativo.csv&#39; ):     </span>
<span class="sd">        #</span>
<span class="sd">        #    Import Accumulated Deaths</span>
<span class="sd">        #    input: </span>
<span class="sd">        #        - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">        #        - initdate: datetime object with the initial date</span>
<span class="sd">        #        - endpoint (optional): </span>
<span class="sd">        #    output: </span>
<span class="sd">        #        - Br: Real accumulated deaths</span>
<span class="sd">        #        - Br_tr: days from simulation first day</span>
<span class="sd">        #        - Br_dates: data dates</span>
<span class="sd">        #    Usage:</span>
<span class="sd">        #        Br,Br_tr,Br_dates = importAccumulatedDeaths(self=None,tstate = &#39;13&#39;,initdate = datetime(2020,5,15))</span>
<span class="sd">        # </span>
<span class="sd">        print(&#39;Importing Accumulated Deaths&#39;)</span>

<span class="sd">        if self:</span>
<span class="sd">            tstate = self.tstate</span>
<span class="sd">            initdate = self.initdate</span>
<span class="sd">        else:</span>
<span class="sd">            if not tstate:</span>
<span class="sd">                raise Exception(&quot;State code missing&quot;)</span>
<span class="sd">            if not initdate:</span>
<span class="sd">                raise Exception(&quot;Initial date missing&quot;)      </span>
<span class="sd">                </span>
<span class="sd">        cut =  [&#39;15&#39;,&#39;01&#39;,&#39;02&#39;,&#39;03&#39;,&#39;04&#39;,&#39;05&#39;,&#39;13&#39;,&#39;06&#39;,&#39;07&#39;,&#39;16&#39;,&#39;08&#39;,&#39;09&#39;,&#39;14&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;,&#39;00&#39;]</span>
<span class="sd">        if type(tstate) == list:</span>
<span class="sd">            tstate = tstate[0]</span>
<span class="sd">        index = cut.index(tstate[:2])</span>
<span class="sd">        Br = pd.read_csv(endpoint).iloc[index][1:] </span>
<span class="sd">        Br_dates = [datetime.strptime(Br.index[i],&#39;%Y-%m-%d&#39;) for i in range(len(Br))]</span>
<span class="sd">        index = np.where(np.array(Br_dates) &gt;= initdate)[0][0] </span>
<span class="sd">        Br = Br[index:]</span>
<span class="sd">        Br_dates = Br_dates[index:]</span>
<span class="sd">        Br_tr = [(Br_dates[i]-initdate).days for i in range(len(Br))]</span>
<span class="sd">        </span>
<span class="sd">        if self:</span>
<span class="sd">            self.Br = Br</span>
<span class="sd">            self.Br_dates = Br_dates</span>
<span class="sd">            self.Br_tr = Br_tr</span>
<span class="sd">            return</span>
<span class="sd">        else:        </span>
<span class="sd">            return Br,Br_tr,Br_dates</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------- #</span>
    <span class="c1">#          Deaths (DEIS)        #</span>
    <span class="c1"># ----------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_deaths_deis"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_deaths_deis">[docs]</a>    <span class="k">def</span> <span class="nf">imp_deaths_deis</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpointreg</span> <span class="o">=</span> <span class="s1">&#39;getDeathsByState?state=&#39;</span><span class="p">,</span><span class="n">endpointcom</span> <span class="o">=</span> <span class="s1">&#39;getDeathsByComuna?comuna=&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;D_confirmed&#39;</span><span class="p">,</span><span class="s1">&#39;D_suspected&#39;</span><span class="p">,</span><span class="s1">&#39;D_ac_confirmed&#39;</span><span class="p">,</span><span class="s1">&#39;D_ac_suspected&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Accumulated Deaths</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - Br: Real accumulated deaths</span>
<span class="sd">                - Br_tr: days from simulation first day</span>
<span class="sd">                - Br_dates: data dates</span>
<span class="sd">            Usage:</span>
<span class="sd">                Br,Br_tr,Br_dates = importAccumulatedDeaths(self=None,tstate = &#39;13&#39;,initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Deaths by DEIS&#39;</span><span class="p">)</span>

        <span class="n">endpointreg</span> <span class="o">=</span> <span class="s1">&#39;getDeathsByState?state=&#39;</span>
        <span class="n">endpointcom</span> <span class="o">=</span> <span class="s1">&#39;getDeathsByComuna?comuna=&#39;</span>
 
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>     
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span> 


        <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="c1">#aux = pd.read_json(endpointcom+tstate[0])</span>
                <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointreg+tstate[0])</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="c1">#aux = pd.read_json(endpointcom+i)</span>
                    <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#aux = pd.read_json(endpointreg+i)</span>
                    <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D_r_confirmed</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">D_r_confirmed</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
                    <span class="n">D_r_suspected</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
                    <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointcom+tstate)</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">tstate</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointreg+tstate)</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">tstate</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

            <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
            <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>            
            <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>
        


        <span class="n">B_r_confirmed</span> <span class="o">=</span> <span class="n">D_r_confirmed</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">B_r_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">D_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">D_r_confirmed</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_dates</span> <span class="o">=</span> <span class="n">D_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">D_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D_r_dates</span><span class="p">))]</span>

        <span class="n">B_r_confirmed</span> <span class="o">=</span> <span class="n">B_r_confirmed</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">B_r_suspected</span> <span class="o">=</span> <span class="n">B_r_suspected</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>



        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">D_r_confirmed</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">D_r_suspected</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">B_r_confirmed</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">B_r_suspected</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> 

            <span class="bp">self</span><span class="o">.</span><span class="n">Dr</span> <span class="o">=</span> <span class="n">D_r_confirmed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dr_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br</span> <span class="o">=</span> <span class="n">B_r_confirmed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_suspected</span> <span class="o">=</span> <span class="n">B_r_suspected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_dates</span> <span class="o">=</span> <span class="n">D_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_tr</span> <span class="o">=</span> <span class="n">D_r_tr</span>            
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">D_r_confirmed</span><span class="p">,</span><span class="n">D_r_suspected</span><span class="p">,</span><span class="n">B_r_confirmed</span><span class="p">,</span><span class="n">B_r_suspected</span><span class="p">,</span><span class="n">D_r_dates</span><span class="p">,</span><span class="n">D_r_tr</span></div>


    <span class="c1"># -------------------------------------- #</span>
    <span class="c1">#          Deaths (DEIS) MinCiencia      #</span>
    <span class="c1"># -------------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_deaths_deis_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_deaths_deis_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_deaths_deis_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto50/DefuncionesDEIS_confirmadosPorComuna.csv&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;D_confirmed&#39;</span><span class="p">,</span><span class="s1">&#39;D_suspected&#39;</span><span class="p">,</span><span class="s1">&#39;D_ac_confirmed&#39;</span><span class="p">,</span><span class="s1">&#39;D_ac_suspected&#39;</span><span class="p">]):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Accumulated Deaths</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - Br: Real accumulated deaths</span>
<span class="sd">                - Br_tr: days from simulation first day</span>
<span class="sd">                - Br_dates: data dates</span>
<span class="sd">            Usage:</span>
<span class="sd">                Br,Br_tr,Br_dates = importAccumulatedDeaths(self=None,tstate = &#39;13&#39;,initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Deaths by DEIS&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span> 
             
        <span class="n">data_confirmed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto50/DefuncionesDEIS_confirmadosPorComuna.csv&#39;</span><span class="p">)</span>
        <span class="n">data_suspected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto50/DefuncionesDEIS_sospechososPorComuna.csv&#39;</span><span class="p">)</span>

        <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="c1">#aux = pd.read_json(endpointcom+tstate[0])</span>
                <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointreg+tstate[0])</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="c1">#aux = pd.read_json(endpointcom+i)</span>
                    <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#aux = pd.read_json(endpointreg+i)</span>
                    <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D_r_confirmed</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">D_r_confirmed</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
                    <span class="n">D_r_suspected</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
                    <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointcom+tstate)</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">tstate</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointreg+tstate)</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">tstate</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

            <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
            <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>            
            <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>
        


        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">D_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">D_r_confirmed</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_dates</span> <span class="o">=</span> <span class="n">D_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">D_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D_r_dates</span><span class="p">))]</span>

        <span class="n">B_r_confirmed</span> <span class="o">=</span> <span class="n">D_r_confirmed</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">B_r_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>


        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update database</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updating database&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">D_r_confirmed</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">D_r_suspected</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">B_r_confirmed</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dfappend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">B_r_suspected</span><span class="p">,</span><span class="n">D_r_tr</span><span class="p">,</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>             
            
            <span class="bp">self</span><span class="o">.</span><span class="n">Dr</span> <span class="o">=</span> <span class="n">D_r_confirmed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dr_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br</span> <span class="o">=</span> <span class="n">B_r_confirmed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_suspected</span> <span class="o">=</span> <span class="n">B_r_suspected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_dates</span> <span class="o">=</span> <span class="n">D_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_tr</span> <span class="o">=</span> <span class="n">D_r_tr</span>            
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">D_r_confirmed</span><span class="p">,</span><span class="n">D_r_suspected</span><span class="p">,</span><span class="n">B_r_confirmed</span><span class="p">,</span><span class="n">B_r_suspected</span><span class="p">,</span><span class="n">D_r_dates</span><span class="p">,</span><span class="n">D_r_tr</span></div>



    <span class="c1"># ------------------------------------ #</span>
    <span class="c1">#    Datos Fallecidos Hospitalizados   #</span>
    <span class="c1"># ------------------------------------ #</span>
<div class="viewcode-block" id="ImportData.imp_hospitalized_deaths"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_hospitalized_deaths">[docs]</a>    <span class="k">def</span> <span class="nf">imp_hospitalized_deaths</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto57/fallecidos_hospitalizados.csv&#39;</span> <span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Accumulated Deaths</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - Dr_hosp: Hospitalized deaths</span>
<span class="sd">                - Dr_Nonhosp: Non Hospitalized deaths                </span>
<span class="sd">                - Br_hosp: Hospitalized Accumulated deaths</span>
<span class="sd">                - Br_Nonhosp: Non Hospitalized Accumulated deaths</span>
<span class="sd">                - Br_hosp_tr: Days since initdate</span>
<span class="sd">                - Dr_hosp_dates: Dates</span>
<span class="sd">            Usage:</span>
<span class="sd">                Dr_hosp, Dr_Nonhosp,Br_hosp, Br_Nonhosp, hosp_tr, hosp_dates =importAccumulatedDeathsHospitalized(tstate = &#39;13&#39;,initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Hospitalized/NonHospitalized Deaths&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>      
        
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.2.223:5006/getDeathsOriginAllStates&#39;</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
       
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="p">]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>            
            <span class="n">aux_fromhospital</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">aux_notfromhospital</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">aux_fromhospital</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;fromHospital&#39;</span><span class="p">])</span>
                <span class="n">aux_notfromhospital</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;notFromHospital&#39;</span><span class="p">])</span>
            
            <span class="c1">#aux.append(data[counties])</span>
            <span class="n">Dr_hosp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux_fromhospital</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Dr_Nonhosp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux_notfromhospital</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No information for counties, getting regional info instead&#39;</span><span class="p">)</span>
            
            <span class="n">Dr_hosp</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;fromHospital&#39;</span><span class="p">]</span>            
            <span class="n">Dr_Nonhosp</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;notFromHospital&#39;</span><span class="p">]</span>
            

                
        <span class="n">hosp_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Dr_hosp</span><span class="p">))]</span>
        <span class="n">Br_hosp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">Dr_hosp</span><span class="p">)</span>
        <span class="n">Br_Nonhosp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">Dr_Nonhosp</span><span class="p">)</span>
        
        
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hosp_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">Dr_hosp</span> <span class="o">=</span> <span class="n">Dr_hosp</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">Dr_Nonhosp</span> <span class="o">=</span> <span class="n">Dr_Nonhosp</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        
        <span class="n">Br_hosp</span> <span class="o">=</span> <span class="n">Br_hosp</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">Br_Nonhosp</span> <span class="o">=</span> <span class="n">Br_Nonhosp</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>

        <span class="n">hosp_dates</span> <span class="o">=</span> <span class="n">hosp_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">hosp_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">hosp_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hosp_dates</span><span class="p">))]</span>


        <span class="c1">#endpoint = &#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto57/fallecidos_hospitalizados.csv&#39;</span>
        <span class="c1">#aux = pd.read_csv(endpoint)</span>
        <span class="c1">#aux = aux.loc[aux[&#39;Region&#39;] == &#39;Metropolitana&#39;]</span>
        <span class="c1">#Dr_hosp = aux.loc[aux[&#39;Hospitalizacion&#39;] == &#39;VERDADERO&#39;][&#39;2020-09-07&#39;]</span>
        <span class="c1">#Dr_Nonhosp = aux.loc[aux[&#39;Hospitalizacion&#39;] == &#39;FALSO&#39;][&#39;2020-09-07&#39;]</span>
        <span class="c1">#hosp_dates =  [datetime.strptime(aux.loc[aux[&#39;Hospitalizacion&#39;] == &#39;VERDADERO&#39;][&#39;Fecha&#39;].tolist()[i], &#39;%Y-%m-%d&#39;) for i in range(len(Dr_hosp))]</span>
        
        <span class="c1">#Br_hosp = Dr_hosp.cumsum()</span>
        <span class="c1">#Br_Nonhosp = Dr_Nonhosp.cumsum()</span>

        <span class="c1">#index = np.where(np.array(hosp_dates) &gt;= initdate)[0][0]</span>
        <span class="c1">#</span>
        <span class="c1">#Dr_hosp = Br_hosp[index:]</span>
        <span class="c1">#Dr_Nonhosp = Br_Nonhosp[index:]</span>
        <span class="c1">#</span>
        <span class="c1">#Br_hosp = Br_hosp[index:]</span>
        <span class="c1">#Br_Nonhosp = Br_Nonhosp[index:]</span>

        <span class="c1">#hosp_dates = hosp_dates[index:]</span>
        <span class="c1">#hosp_tr = [(hosp_dates[i]-initdate).days for i in range(len(hosp_dates))]</span>
        <span class="c1">#</span>
        <span class="c1">##V_F = [Br_Nonhosp.iloc[i]/Br_hosp.iloc[i] for i in range(len(Br_Nonhosp))]</span>
        
      
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dr_hosp</span> <span class="o">=</span> <span class="n">Dr_hosp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dr_Nonhosp</span> <span class="o">=</span> <span class="n">Dr_Nonhosp</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_hosp</span> <span class="o">=</span> <span class="n">Br_hosp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_Nonhosp</span> <span class="o">=</span> <span class="n">Br_Nonhosp</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hosp_dates</span> <span class="o">=</span> <span class="n">hosp_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hosp_tr</span> <span class="o">=</span> <span class="n">hosp_tr</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">Dr_hosp</span><span class="p">,</span> <span class="n">Dr_Nonhosp</span><span class="p">,</span><span class="n">Br_hosp</span><span class="p">,</span> <span class="n">Br_Nonhosp</span><span class="p">,</span> <span class="n">hosp_tr</span><span class="p">,</span> <span class="n">hosp_dates</span>            </div>



    <span class="c1"># -------------------------- #</span>
    <span class="c1">#    Fallecidos excesivos    #</span>
    <span class="c1"># -------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_deaths_excess"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_deaths_excess">[docs]</a>    <span class="k">def</span> <span class="nf">imp_deaths_excess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/home/samuel/Documents/Dlab/data/Excess_dead_daily.csv&#39;</span><span class="p">):</span>
        <span class="c1">#path = &#39;/home/samuel/Documents/Dlab/data/Excess_dead_daily.csv&#39;</span>
        
        <span class="n">excess_dead</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_df</span> <span class="o">=</span> <span class="n">excess_dead</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">excess_dead</span><span class="p">[</span><span class="s1">&#39;Codigo region&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">])]</span>      
        <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_df</span><span class="p">[</span><span class="s1">&#39;Defunciones Covid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_df</span><span class="p">[</span><span class="s1">&#39;Exceso de muertes media poderada&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_df</span><span class="p">))]</span>       

        <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_df</span><span class="p">[</span><span class="s1">&#39;Fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_df</span><span class="p">))]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">enddate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_dates</span><span class="p">)</span>
        <span class="n">indexend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">enddate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">indexend</span><span class="p">]</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">indexend</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_ac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ED_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ED_RM</span><span class="p">))]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Excesive Deaths&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>


    <span class="c1"># -------------------------------- #</span>
    <span class="c1">#      PCR and population data     #</span>
    <span class="c1"># -------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_pcr_population"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_pcr_population">[docs]</a>    <span class="k">def</span> <span class="nf">imp_pcr_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto7/PCR.csv&#39;</span><span class="p">):</span>
        <span class="n">cut</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;15&#39;</span><span class="p">,</span><span class="s1">&#39;01&#39;</span><span class="p">,</span><span class="s1">&#39;02&#39;</span><span class="p">,</span><span class="s1">&#39;03&#39;</span><span class="p">,</span><span class="s1">&#39;04&#39;</span><span class="p">,</span><span class="s1">&#39;05&#39;</span><span class="p">,</span><span class="s1">&#39;13&#39;</span><span class="p">,</span><span class="s1">&#39;06&#39;</span><span class="p">,</span><span class="s1">&#39;07&#39;</span><span class="p">,</span><span class="s1">&#39;16&#39;</span><span class="p">,</span><span class="s1">&#39;08&#39;</span><span class="p">,</span><span class="s1">&#39;09&#39;</span><span class="p">,</span><span class="s1">&#39;14&#39;</span><span class="p">,</span><span class="s1">&#39;10&#39;</span><span class="p">,</span><span class="s1">&#39;11&#39;</span><span class="p">,</span><span class="s1">&#39;12&#39;</span><span class="p">,</span><span class="s1">&#39;00&#39;</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">cut</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tstate</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;Poblacion&#39;</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">pcr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">pcr_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcr</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="p">))]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">pcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcr</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcr_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcr_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcr_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcr_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="p">))]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PCR Y poblacion&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>


    <span class="c1"># ----------------------------- #</span>
    <span class="c1">#    Import Adjacency Matrix    #</span>
    <span class="c1"># ----------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_adj_matrix_regional"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_adj_matrix_regional">[docs]</a>    <span class="k">def</span> <span class="nf">imp_adj_matrix_regional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tstate</span><span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.2.223:5006/getRegionalAdjacencyMatrix&#39;</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import adjacency data </span>
<span class="sd">        N is the adjacency order, with 0 meaning the immediate neighbors, 1 the neighbor&#39;s neighbors, and so on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Regional Adjacency&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="n">tstate</span>
            <span class="n">adjacency_lvl</span> <span class="o">=</span> <span class="n">tstate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="p">[</span><span class="n">tstate</span><span class="p">]</span>
            <span class="n">adjacency_lvl</span> <span class="o">=</span> <span class="p">[</span><span class="n">tstate</span><span class="p">]</span>
        <span class="n">adjacency_lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">adjacency</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[]</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">adjacency_lvl</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">aux</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># Remove duplicates                </span>
                <span class="n">aux</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">aux</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adjacency</span><span class="p">]</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aux</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>                
                <span class="n">adjacency_lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
                <span class="n">adjacency</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacencyR</span> <span class="o">=</span> <span class="n">adjacency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacencyR_lvl</span> <span class="o">=</span> <span class="n">adjacency_lvl</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">adjacency</span><span class="p">,</span> <span class="n">adjacency_lvl</span></div>


<div class="viewcode-block" id="ImportData.imp_adj_matrix_national"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_adj_matrix_national">[docs]</a>    <span class="k">def</span> <span class="nf">imp_adj_matrix_national</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tstate</span><span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.2.223:5006/getNationalAdjacencyMatrix&#39;</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import adjacency data </span>
<span class="sd">        N is the adjacency order, with 0 meaning the immediate neighbors, 1 the neighbor&#39;s neighbors, and so on.</span>
<span class="sd">        Input:</span>
<span class="sd">            - tstate [string or list of strings]</span>
<span class="sd">            - N: Neighors Order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing National Adjacency&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="n">tstate</span>
            <span class="n">adjacency_lvl</span> <span class="o">=</span> <span class="n">tstate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="p">[</span><span class="n">tstate</span><span class="p">]</span>
            <span class="n">adjacency_lvl</span> <span class="o">=</span> <span class="p">[</span><span class="n">tstate</span><span class="p">]</span>
        <span class="n">adjacency_lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">adjacency</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[]</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">adjacency_lvl</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">aux</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># Remove duplicates                </span>
                <span class="n">aux</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">aux</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adjacency</span><span class="p">]</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aux</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>                
                <span class="n">adjacency_lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
                <span class="n">adjacency</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="n">adjacency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_lvl</span> <span class="o">=</span> <span class="n">adjacency_lvl</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">adjacency</span><span class="p">,</span> <span class="n">adjacency_lvl</span></div>

    <span class="c1"># ---------------------- #</span>
    <span class="c1">#    Import Lockdowns    #</span>
    <span class="c1"># ---------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_lockdowns"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_lockdowns">[docs]</a>    <span class="k">def</span> <span class="nf">imp_lockdowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tstate</span><span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import Lockdowns data </span>
<span class="sd">        So far from local data</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Lockdown data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
        
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;../Data/Confinamiento_COVID19.xlsx&#39;</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;Confinamiento_COVID19.xlsx&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
        
        <span class="n">Data</span><span class="p">[</span><span class="n">tstate</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="c1"># fig, ax = plt.subplots()</span>
        <span class="c1"># ax.plot(valdivia.astype(int))   </span>
        <span class="c1"># ax.fmt_xdata = mdates.DateFormatter(&#39;%Y-%m-%d&#39;) </span>
        <span class="c1"># plt.show() </span>

        <span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="n">tstate</span>
            <span class="n">adjacency_lvl</span> <span class="o">=</span> <span class="n">tstate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="p">[</span><span class="n">tstate</span><span class="p">]</span>
            <span class="n">adjacency_lvl</span> <span class="o">=</span> <span class="p">[</span><span class="n">tstate</span><span class="p">]</span>
        <span class="n">adjacency_lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">adjacency</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tstate</span><span class="p">)][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[]</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">adjacency_lvl</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">aux</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># Remove duplicates                </span>
                <span class="n">aux</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">aux</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adjacency</span><span class="p">]</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aux</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>                
                <span class="n">adjacency_lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
                <span class="n">adjacency</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacencyR</span> <span class="o">=</span> <span class="n">adjacency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacencyR_lvl</span> <span class="o">=</span> <span class="n">adjacency_lvl</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">adjacency</span><span class="p">,</span> <span class="n">adjacency_lvl</span></div>


    <span class="c1"># ------------------------------------------- #</span>
    <span class="c1">#    Import Effective Reproduction Number     #</span>
    <span class="c1"># ------------------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_reproduction_number"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_reproduction_number">[docs]</a>    <span class="k">def</span> <span class="nf">imp_reproduction_number</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpointcounty</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.2.223:5006/getEffectiveReproductionAllComunas&#39;</span><span class="p">,</span> <span class="n">endpointstates</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.2.223:5006/getEffectiveReproductionAllStates&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Import Effective Reproduction Number</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - Br: Real accumulated deaths</span>
<span class="sd">                - Br_tr: days from simulation first day</span>
<span class="sd">                - Br_dates: data dates</span>
<span class="sd">            Usage:</span>
<span class="sd">                Br,Br_tr,Br_dates = importAccumulatedDeaths(self=None,tstate = &#39;13&#39;,initdate = datetime(2020,5,15))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Effective Reproduction Number&#39;</span><span class="p">)</span>
 
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>     
            <span class="n">request</span> <span class="o">=</span> <span class="n">dataretriever</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">password</span><span class="p">)</span> 

        <span class="n">auxcounty</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpointcounty</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">auxstate</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpointstates</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">tstate</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">or</span> <span class="n">tstate</span> <span class="o">==</span> <span class="s1">&#39;00&#39;</span><span class="p">:</span>
            <span class="n">auxnacional</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://192.168.2.223:5006/getNationalEffectiveReproduction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">datacounty</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxcounty</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">datastate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auxstate</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
                
        <span class="n">R_eff_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">auxcounty</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">auxcounty</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">]))]</span>


        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="p">]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">]</span>            
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            
            <span class="n">aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">counties</span><span class="p">])</span>
            <span class="n">R_eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">R_eff</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">tstate</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">R_eff</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tstate</span><span class="p">])</span>

        <span class="c1">#R_</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="c1">#aux = pd.read_json(endpointcom+tstate[0])</span>
                <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointreg+tstate[0])</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">tstate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="c1">#aux = pd.read_json(endpointcom+i)</span>
                    <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#aux = pd.read_json(endpointreg+i)</span>
                    <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D_r_confirmed</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">D_r_confirmed</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
                    <span class="n">D_r_suspected</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
                    <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstate</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointcom+tstate)</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointcom</span><span class="o">+</span><span class="n">tstate</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#aux = pd.read_json(endpointreg+tstate)</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="n">endpointreg</span><span class="o">+</span><span class="n">tstate</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

            <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">])</span>
            <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;suspected&#39;</span><span class="p">])</span>            
            <span class="n">D_r_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))]</span>
        


        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">D_r_dates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">initdate</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">D_r_confirmed</span> <span class="o">=</span> <span class="n">D_r_confirmed</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_dates</span> <span class="o">=</span> <span class="n">D_r_dates</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">D_r_tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">D_r_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">initdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D_r_dates</span><span class="p">))]</span>

        <span class="n">B_r_confirmed</span> <span class="o">=</span> <span class="n">D_r_confirmed</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">B_r_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

        
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dr</span> <span class="o">=</span> <span class="n">D_r_confirmed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dr_suspected</span> <span class="o">=</span> <span class="n">D_r_suspected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br</span> <span class="o">=</span> <span class="n">B_r_confirmed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_suspected</span> <span class="o">=</span> <span class="n">B_r_suspected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_dates</span> <span class="o">=</span> <span class="n">D_r_dates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br_tr</span> <span class="o">=</span> <span class="n">D_r_tr</span>            
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">D_r_confirmed</span><span class="p">,</span><span class="n">D_r_suspected</span><span class="p">,</span><span class="n">B_r_confirmed</span><span class="p">,</span><span class="n">B_r_suspected</span><span class="p">,</span><span class="n">D_r_dates</span><span class="p">,</span><span class="n">D_r_tr</span></div>


    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # ------------------------------------------- #</span>
<span class="sd">    #    Import Vaccines     #</span>
<span class="sd">    # ------------------------------------------- #</span>
<span class="sd">    def imp_vaccine_mcyt(self=None,tstate = &#39;&#39;,initdate = None,endpoint = &#39;https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto76/vacunacion.csv&#39;,user=None,password=None):     </span>
<span class="sd">       </span>
<span class="sd">            Import Vaccines</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - V_1st: First Dose (2 doses vaccine)</span>
<span class="sd">                - V_2nd: Second Dose (2 doses vaccine)</span>
<span class="sd">                - V_unique: Unique Dose (1 dose vaccine)</span>
<span class="sd">                - V_3rd: Boost Dose               </span>
<span class="sd">                </span>
<span class="sd">            Usage:</span>
<span class="sd">                -</span>
<span class="sd">       </span>
<span class="sd">        cuttoname = {&#39;15&#39;: &#39;Arica y Parinacota&#39;, &#39;01&#39;: &#39;Tarapacá&#39;, &#39;02&#39;: &#39;Antofagasta&#39;, &#39;03&#39;: &#39;Atacama&#39;, &#39;04&#39;: &#39;Coquimbo&#39;, &#39;05&#39;: &#39;Valparaíso&#39;, &#39;13&#39;: &#39;Metropolitana&#39;, &#39;06&#39;: &#39;O’Higgins&#39;, &#39;07&#39;: &#39;Maule&#39;, &#39;16&#39;: &#39;Ñuble&#39;, &#39;08&#39;: &#39;Biobío&#39;, &#39;09&#39;: &#39;Araucanía&#39;, &#39;14&#39;: &#39;Los Ríos&#39;, &#39;10&#39;: &#39;Los Lagos&#39;, &#39;11&#39;: &#39;Aysén&#39;, &#39;12&#39;: &#39;Magallanes&#39;}</span>

<span class="sd">        print(&#39;Importing Vaccines&#39;)</span>

<span class="sd">        data = pd.read_csv(endpoint)</span>
<span class="sd">        dates = data.columns[2:]</span>

<span class="sd">        Vac_RM = data.loc[data[&#39;Region&#39;]==&#39;Metropolitana&#39;]</span>
<span class="sd">        vacunas_ac = Vac_RM.loc[(Vac_RM[&#39;Dosis&#39;]==&#39;Segunda&#39;)|(Vac_RM[&#39;Dosis&#39;]==&#39;Unica&#39;)].iloc[:,2:].sum()</span>
<span class="sd">        vacunas_ac.index = pd.to_datetime(vacunas_ac.index)</span>
<span class="sd">        vacunas_d = vacunas_ac.diff()</span>
<span class="sd">        vacunas_ac = vacunas_ac.iloc[vacunas_ac.index&gt;=initdate]</span>
<span class="sd">        vacunas_d = vacunas_d.iloc[vacunas_d.index&gt;=initdate]</span>
<span class="sd"> </span>
<span class="sd">        if self:</span>
<span class="sd">            tstate = self.tstate</span>
<span class="sd">            initdate = self.initdate</span>
<span class="sd">            request = self.request</span>
<span class="sd">        else:</span>
<span class="sd">            if not tstate:</span>
<span class="sd">                raise Exception(&quot;State code missing&quot;)</span>
<span class="sd">            if not initdate:</span>
<span class="sd">                raise Exception(&quot;Initial date missing&quot;)     </span>
<span class="sd">            request = dataretriever(user,password) </span>

<span class="sd">        auxcounty = requests.get(endpointcounty).json()</span>
<span class="sd">        auxstate = requests.get(endpointstates).json()</span>

<span class="sd">        if tstate == &#39;0&#39; or tstate == &#39;00&#39;:</span>
<span class="sd">            auxnacional = requests.get(&#39;http://192.168.2.223:5006/getNationalEffectiveReproduction&#39;).json()</span>
<span class="sd">        datacounty = pd.DataFrame(auxcounty[&#39;data&#39;])</span>
<span class="sd">        datastate = pd.DataFrame(auxstate[&#39;data&#39;])</span>
<span class="sd">                </span>
<span class="sd">        R_eff_dates = [datetime.strptime(auxcounty[&#39;dates&#39;][i][:10],&#39;%Y-%m-%d&#39;) for i in range(len(auxcounty[&#39;dates&#39;]))]</span>


<span class="sd">        if type(tstate) == list:</span>
<span class="sd">            counties = [i for i in tstate if len(i)&gt;2 ]</span>
<span class="sd">            states = [i for i in tstate if len(i)==2 ]            </span>
<span class="sd">            aux = []</span>
<span class="sd">            for i in states:</span>
<span class="sd">                aux.append(data.filter(regex=&#39;^&#39;+i,axis=1))</span>
<span class="sd">            </span>
<span class="sd">            aux.append(data[counties])</span>
<span class="sd">            R_eff = np.array(pd.concat(aux, axis=1).sum(axis=1))</span>
<span class="sd">        </span>
<span class="sd">        else:</span>
<span class="sd">            if len(tstate) == 2:</span>
<span class="sd">                R_eff = data.filter(regex=&#39;^&#39;+tstate,axis=1).sum(axis=1)</span>
<span class="sd">            elif len(tstate) &gt; 2:</span>
<span class="sd">                R_eff = (data[tstate])</span>

<span class="sd">        #R_</span>
<span class="sd">        if type(tstate) == list:</span>
<span class="sd">            if len(tstate[0])&gt;2:</span>
<span class="sd">                aux = pd.DataFrame(request(endpointcom+tstate[0]).json())</span>
<span class="sd">                #aux = pd.read_json(endpointcom+tstate[0])</span>
<span class="sd">                D_r_dates = [datetime.strptime(aux[&#39;dates&#39;][i][:10],&#39;%Y-%m-%d&#39;) for i in range(len(aux))]</span>
<span class="sd">            else:</span>
<span class="sd">                #aux = pd.read_json(endpointreg+tstate[0])</span>
<span class="sd">                aux = pd.DataFrame(request(endpointreg+tstate[0]).json())</span>
<span class="sd">                D_r_dates = [datetime.strptime(aux[&#39;dates&#39;][i][:10],&#39;%Y-%m-%d&#39;) for i in range(len(aux))]</span>

<span class="sd">            for i in tstate:</span>
<span class="sd">                if len(i)&gt;2:</span>
<span class="sd">                    #aux = pd.read_json(endpointcom+i)</span>
<span class="sd">                    aux = pd.DataFrame(request(endpointcom+i).json())</span>
<span class="sd">                else:</span>
<span class="sd">                    #aux = pd.read_json(endpointreg+i)</span>
<span class="sd">                    aux = pd.DataFrame(request(endpointreg+i).json())</span>
<span class="sd">                if len(D_r_confirmed)&gt;1:</span>
<span class="sd">                    D_r_confirmed += np.array(aux[&#39;confirmed&#39;])</span>
<span class="sd">                    D_r_suspected += np.array(aux[&#39;suspected&#39;])</span>
<span class="sd">                else:</span>
<span class="sd">                    D_r_confirmed = np.array(aux[&#39;confirmed&#39;])</span>
<span class="sd">                    D_r_suspected = np.array(aux[&#39;suspected&#39;])</span>
<span class="sd">        else:        </span>
<span class="sd">            if len(tstate)&gt;2:</span>
<span class="sd">                #aux = pd.read_json(endpointcom+tstate)</span>
<span class="sd">                aux = pd.DataFrame(request(endpointcom+tstate).json())</span>
<span class="sd">            else:</span>
<span class="sd">                #aux = pd.read_json(endpointreg+tstate)</span>
<span class="sd">                aux = pd.DataFrame(request(endpointreg+tstate).json())</span>

<span class="sd">            D_r_confirmed = np.array(aux[&#39;confirmed&#39;])</span>
<span class="sd">            D_r_suspected = np.array(aux[&#39;suspected&#39;])            </span>
<span class="sd">            D_r_dates = [datetime.strptime(aux[&#39;dates&#39;][i][:10],&#39;%Y-%m-%d&#39;) for i in range(len(aux))]</span>
<span class="sd">        </span>


<span class="sd">        index = np.where(np.array(D_r_dates) &gt;= initdate)[0][0] </span>
<span class="sd">        D_r_confirmed = D_r_confirmed[index:]</span>
<span class="sd">        D_r_suspected = D_r_suspected[index:]</span>
<span class="sd">        D_r_dates = D_r_dates[index:]</span>
<span class="sd">        D_r_tr = [(D_r_dates[i]-initdate).days for i in range(len(D_r_dates))]</span>

<span class="sd">        B_r_confirmed = D_r_confirmed.cumsum()</span>
<span class="sd">        B_r_suspected = D_r_suspected.cumsum()</span>

<span class="sd">        </span>
<span class="sd">        if self:</span>
<span class="sd">            self.Dr = D_r_confirmed</span>
<span class="sd">            self.Dr_suspected = D_r_suspected</span>
<span class="sd">            self.Br = B_r_confirmed</span>
<span class="sd">            self.Br_suspected = B_r_suspected</span>
<span class="sd">            self.Br_dates = D_r_dates</span>
<span class="sd">            self.Br_tr = D_r_tr            </span>
<span class="sd">            return</span>
<span class="sd">        else:        </span>
<span class="sd">            return D_r_confirmed,D_r_suspected,B_r_confirmed,B_r_suspected,D_r_dates,D_r_tr</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># ------------------------------------------- #</span>
    <span class="c1">#      National Vaccinated Infected Data      #</span>
    <span class="c1"># ------------------------------------------- #</span>
<div class="viewcode-block" id="ImportData.imp_vacc_infected_mcyt"><a class="viewcode-back" href="../../../cv19gm.data.html#cv19gm.data.cv19data.ImportData.imp_vacc_infected_mcyt">[docs]</a>    <span class="k">def</span> <span class="nf">imp_vacc_infected_mcyt</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tstate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">initdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/MinCiencia/Datos-COVID19/raw/master/output/producto90/incidencia_en_vacunados.csv&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>     
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Product 90 has data of: </span>
<span class="sd">                * </span>
<span class="sd">            Import Vaccines</span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint (optional): </span>
<span class="sd">            output: </span>
<span class="sd">                - V_1st: First Dose (2 doses vaccine)</span>
<span class="sd">                - V_complete: complete (1 or 2 doses vaccine)</span>
<span class="sd">                - V_boost: Boost Dose               </span>
<span class="sd">                </span>
<span class="sd">            Usage:</span>
<span class="sd">                -</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Importing Vaccines&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>        
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;semana_epidemiologica&#39;</span><span class="p">]]</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
        
        <span class="n">initweek</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">initdate</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">days</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span>

        
        <span class="c1"># Active vaccinated infected</span>
        <span class="n">Iv0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dos_dosis_comp_casos&#39;</span><span class="p">][</span><span class="n">initweek</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">initweek</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dosis_unica_comp_casos&#39;</span><span class="p">][</span><span class="n">initweek</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">initweek</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dosis_ref_comp_casos&#39;</span><span class="p">][</span><span class="n">initweek</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">initweek</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">Iv_ac</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dos_dosis_comp_casos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dosis_unica_comp_casos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dosis_ref_comp_casos&#39;</span><span class="p">]</span>
        
        <span class="n">Iv_ac</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
        <span class="n">Iv_ac</span> <span class="o">=</span> <span class="n">Iv_ac</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Iv_ac</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;</span><span class="n">initdate</span><span class="p">]</span>

        <span class="n">Iv_d0</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dos_dosis_comp_casos&#39;</span><span class="p">][</span><span class="n">initweek</span><span class="p">]</span> <span class="o">+</span>  <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dos_dosis_comp_casos&#39;</span><span class="p">][</span><span class="n">initweek</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dosis_ref_comp_casos&#39;</span><span class="p">][</span><span class="n">initweek</span><span class="p">])</span><span class="o">/</span><span class="mi">7</span>        
        <span class="n">Iv_ac0</span> <span class="o">=</span> <span class="n">Iv_ac</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
         

 
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstate</span>
            <span class="n">initdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tstate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State code missing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">initdate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Initial date missing&quot;</span><span class="p">)</span>     
        
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Iv_ac</span> <span class="o">=</span> <span class="n">Iv_ac</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Iv_ac0</span> <span class="o">=</span> <span class="n">Iv_ac0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Iv_d0</span> <span class="o">=</span> <span class="n">Iv_d0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Iv0</span> <span class="o">=</span> <span class="n">Iv0</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">Iv_ac</span><span class="p">,</span><span class="n">Iv_ac0</span><span class="p">,</span><span class="n">Iv_d0</span><span class="p">,</span><span class="n">Iv0</span></div>





    <span class="c1"># ---------------------------------------- #</span>
    <span class="c1">#       Datos Subreporte de Infectados     #</span>
    <span class="c1"># ---------------------------------------- #</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    def importInfectedSubreport(self = None,tstate = &#39;&#39;, initdate = None,endpoint = &#39;&#39;):</span>
<span class="sd">        </span>
<span class="sd">            Import calculated active infected subreport </span>
<span class="sd">            This Function imports the  calculated active infected subreport by the given region. </span>
<span class="sd">            When working with counties, we&#39;ll assume that the subreport is homogeneous for the whole region. </span>
<span class="sd">            input: </span>
<span class="sd">                - tstate: [string or string list] CUT por comuna o región</span>
<span class="sd">                - initdate: datetime object with the initial date</span>
<span class="sd">                - endpoint [deprecated]: </span>
<span class="sd">            output: </span>
<span class="sd">                - I_ac_r: Real Accumulated infected</span>
<span class="sd">                - I_ac_r_tr: days from simulation first day</span>
<span class="sd">                - I_ac_r_dates: data dates</span>

<span class="sd">            Variables when used as Object:</span>
<span class="sd">                self.I_ac_r</span>
<span class="sd">                self.I_ac_r_tr</span>
<span class="sd">                self.I_ac_r_dates</span>

<span class="sd">            Usage as function:</span>
<span class="sd">                I_ac_r, I_ac_r_tr,I_ac_r_dates= importAccumulatedInfected(tstate = &#39;13101&#39;,initdate=datetime(2020,5,15))</span>

<span class="sd">                </span>

<span class="sd">        </span>
<span class="sd">        print(&#39;Importing Subreported Infeted&#39;)        </span>
<span class="sd">        if self:</span>
<span class="sd">            tstate = self.tstate</span>
<span class="sd">            initdate = self.initdate</span>
<span class="sd">        else:</span>
<span class="sd">            if not tstate:</span>
<span class="sd">                raise Exception(&quot;State code missing&quot;)</span>
<span class="sd">            if not initdate:</span>
<span class="sd">                raise Exception(&quot;Initial date missing&quot;)          </span>

<span class="sd">        # Import Active Infected Data</span>
<span class="sd">        Ir_endpoint = &#39;http://192.168.2.223:5006/getActiveCasesAllComunas&#39;</span>
<span class="sd">        Ir = pd.DataFrame(requests.get(Ir_endpoint).json()[&#39;data&#39;])</span>
<span class="sd">        </span>

<span class="sd">        # Import Subreport proportion data</span>
<span class="sd">        # This is only calculated for states and then for counties </span>
<span class="sd">        endpoint = &#39;http://192.168.2.223:5006/getActiveCasesUnderreportByState&#39;</span>
<span class="sd">        SR_data = pd.DataFrame(requests.get(endpoint).json()[&#39;data&#39;])</span>

<span class="sd">        if type(tstate) == list:            </span>

<span class="sd">            # State list</span>
<span class="sd">            states = [i for i in tstate if len(i)==2 ]</span>
<span class="sd">            </span>
<span class="sd">            # Adding counties&#39; states</span>
<span class="sd">            counties = [i for i in tstate if len(i)&gt;2 ]</span>
<span class="sd">            </span>
<span class="sd">            # Get Subreport data for selected states</span>
<span class="sd">            for i in counties:</span>
<span class="sd">                if i[:2] not in states:</span>
<span class="sd">                    states.append(i[:2])</span>
<span class="sd">            </span>
<span class="sd">            aux = []</span>
<span class="sd">            for i in tstate:</span>
<span class="sd">                if len(i)&gt;2:</span>
<span class="sd">                    aux_estimate = [Ir[i][j]*SR_data[i[:2]].loc[&#39;estimate&#39;][j] for j in range(len(SR_data[i[:2]].loc[&#39;estimate&#39;]))]</span>
<span class="sd">                    aux_lower = 0</span>
<span class="sd">                    aux_upper = 0</span>

<span class="sd">                aux.append()</span>
<span class="sd">            for i in states:</span>
<span class="sd">                aux.append(data.filter(regex=&#39;^&#39;+i,axis=1))</span>
<span class="sd">            </span>
<span class="sd">            aux.append(data[counties])</span>
<span class="sd">            I_ac_r = pd.concat(aux, axis=1).sum(axis=1)</span>
<span class="sd">        </span>
<span class="sd">        else:</span>
<span class="sd">            if len(tstate) == 2:</span>
<span class="sd">                I_ac_r = data.filter(regex=&#39;^&#39;+tstate,axis=1)</span>
<span class="sd">            elif len(tstate) &gt; 2:</span>
<span class="sd">                I_ac_r = data[tstate]</span>

<span class="sd">        #estimate = data[</span>

<span class="sd">        path = &quot;../Data/subreporte.csv&quot;</span>
<span class="sd">        subreporte = pd.read_csv(path)</span>
<span class="sd">        subreporte = subreporte.drop(columns = [&#39;Unnamed: 0&#39;])</span>
<span class="sd">        subreporte = subreporte.loc[subreporte[&#39;cut&#39;]==int(tstate[:2])]</span>
<span class="sd">        subreporte_date = [datetime.strptime(i, &#39;%Y-%m-%d&#39;) for i in subreporte[&#39;fecha&#39;]]</span>
<span class="sd">        index = np.where(np.array(subreporte_date) &gt;= initdate)[0][0]</span>
<span class="sd">        subreporte = subreporte.iloc[index:]</span>
<span class="sd">        subreporte_date = subreporte_date[index:]</span>
<span class="sd">        subreporte_tr = [(subreporte_date[i]-initdate).days for i in range(len(subreporte))]</span>

<span class="sd">        # Get and filter by dates</span>
<span class="sd">        dates = list(requests.get(endpoint).json()[&#39;dates&#39;])</span>
<span class="sd">        SR_dates = [datetime.strptime(dates[i][:10],&#39;%Y-%m-%d&#39;) for i in range(len(dates))]        </span>
<span class="sd">        index = np.where(np.array(Ir_dates) &gt;= initdate)[0][0]</span>
<span class="sd">        SR_dates=SR_dates[index:]</span>
<span class="sd">        SR_tr = [(SR_dates[i]-initdate).days for i in range(len(SR_dates))]        </span>

<span class="sd">        SR=SR[index:]</span>
<span class="sd">        </span>
<span class="sd">        </span>


<span class="sd">        # Import Active infected and calculate Real Active Infected: </span>
<span class="sd">        cutlistendpoint = &#39;http://192.168.2.220:8080/covid19/selectComunas&#39;</span>
<span class="sd">        cutlist  = pd.read_json(cutlistendpoint)[[&#39;cut&#39;,&#39;idState&#39;]]        </span>

<span class="sd">        actives = []</span>
<span class="sd">        mydict = None</span>
<span class="sd">        if type(tstate) == list:</span>
<span class="sd">            for i in tstate:</span>
<span class="sd">                if len(i)&lt;=2:</span>
<span class="sd">                    aux = cutlist[cutlist[&#39;idState&#39;]==int(i)]</span>
<span class="sd">                    for j in aux[&#39;cut&#39;]:    </span>
<span class="sd">                        auxendpoint = endpoint+str(j).zfill(5)</span>
<span class="sd">                        r = requests.get(auxendpoint) </span>
<span class="sd">                        mydict = r.json()</span>
<span class="sd">                        actives.append(mydict[&#39;actives&#39;])</span>
<span class="sd">                        #data=pd.DataFrame(mydict)</span>
<span class="sd">                    #Ir = (np.array(actives)).sum(axis=0)</span>
<span class="sd">                elif len(i)&gt;2:</span>
<span class="sd">                    auxendpoint = endpoint+i</span>
<span class="sd">                    r = requests.get(auxendpoint) </span>
<span class="sd">                    mydict = r.json()</span>
<span class="sd">                    actives.append(mydict[&#39;actives&#39;])</span>
<span class="sd">                    #Ir = np.array(mydict[&#39;actives&#39;])</span>
<span class="sd">                Ir = (np.array(actives)).sum(axis=0)</span>
<span class="sd">        else:</span>
<span class="sd">            if len(tstate)&lt;=2:</span>
<span class="sd">                aux = cutlist[cutlist[&#39;idState&#39;]==int(tstate)]</span>
<span class="sd">                for j in aux[&#39;cut&#39;]:</span>
<span class="sd">                    auxendpoint = endpoint+str(j).zfill(5)</span>
<span class="sd">                    r = requests.get(auxendpoint) </span>
<span class="sd">                    mydict = r.json()</span>
<span class="sd">                    actives.append(mydict[&#39;actives&#39;])</span>
<span class="sd">                    </span>
<span class="sd">                Ir = (np.array(actives)).sum(axis=0)</span>
<span class="sd">            elif len(tstate)&gt;2:</span>
<span class="sd">                auxendpoint = endpoint+tstate</span>
<span class="sd">                r = requests.get(auxendpoint) </span>
<span class="sd">                mydict = r.json()</span>
<span class="sd">                Ir = np.array(mydict[&#39;actives&#39;])</span>


<span class="sd">        if self:</span>
<span class="sd">            self.subreporte = subreporte</span>
<span class="sd">            self.subreporte_estimate = np.array(subreporte[&#39;estimate&#39;])</span>
<span class="sd">            self.subreporte_date = subreporte_date</span>
<span class="sd">            self.subreporte_tr = subreporte_tr</span>
<span class="sd">            return</span>
<span class="sd">        else:        </span>
<span class="sd">            return subreporte, np.array(subreporte[&#39;estimate&#39;]), subreporte_date, subreporte_tr</span>

<span class="sd">    #self.importSubreporte = self.importInfectedSubreport</span>
<span class="sd">    &quot;&quot;&quot;</span>    </div>



<span class="c1">#self.importfallecidosacumulados()</span>
<span class="c1">#self.importinfectadosactivosminciencia()</span>
<span class="c1">#self.importsochimi()</span>
<span class="c1">#self.importPopulation()</span>
<span class="c1">#self.importinfectadosactivos()</span>
<span class="c1">#self.importinfectadosdiarios()</span>
<span class="c1">#self.importinfectadosacumulados()        </span>
<span class="c1">##self.importSubreporte()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Samuel Ropert.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>